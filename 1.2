



++++++++++++++++++++++

root@sapl8464:/home/dockeruser/n8n-worker# docker-compose logs -f n8n
Attaching to n8n
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n exited with code 255
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory





++++++++++++++++++++++++++++++++


docker-compose logs -f n8n | grep -i proxy

++++++++++++++


FROM n8nio/n8n:latest

ARG HTTP_PROXY=http://10.132.222.73:9090
ARG HTTPS_PROXY=http://10.132.222.73:9090

USER root

# Configurar proxy para npm durante el build
RUN npm config set proxy ${HTTP_PROXY} && \
    npm config set https-proxy ${HTTPS_PROXY} && \
    npm config set strict-ssl false

# Instalar proxy-agent (compatible con undici/fetch de Node.js 18+)
RUN npm install -g proxy-agent

# Limpiar config de npm
RUN npm config delete proxy && \
    npm config delete https-proxy

# Crear módulo que parchea fetch globalmente ANTES de que n8n inicie
RUN mkdir -p /opt/proxy-setup && \
    cat > /opt/proxy-setup/index.js << 'PROXYPATCH'
const { ProxyAgent } = require('proxy-agent');

const proxyUrl = process.env.HTTPS_PROXY || process.env.HTTP_PROXY;

if (proxyUrl) {
  const agent = new ProxyAgent(proxyUrl);
  
  // Parchear fetch global
  const originalFetch = globalThis.fetch;
  globalThis.fetch = function(url, options = {}) {
    if (typeof url === 'string' && url.startsWith('https://')) {
      options.dispatcher = agent;
    }
    return originalFetch(url, options);
  };
  
  console.log('✓ Proxy agent configurado:', proxyUrl);
} else {
  console.log('⚠ No se encontró configuración de proxy');
}
PROXYPATCH

# Script de inicio
RUN cat > /usr/local/bin/start-n8n.sh << 'STARTSCRIPT'
#!/bin/sh
export HTTP_PROXY=http://10.132.222.73:9090
export HTTPS_PROXY=http://10.132.222.73:9090
export NO_PROXY=localhost,127.0.0.1,postgres,redis
export NODE_TLS_REJECT_UNAUTHORIZED=0

# Iniciar con el patch de proxy
exec node -r /opt/proxy-setup/index.js /usr/local/bin/n8n "$@"
STARTSCRIPT

RUN chmod +x /usr/local/bin/start-n8n.sh

USER node

ENTRYPOINT ["/usr/local/bin/start-n8n.sh"]


+++++++++++++
root@sapl8464:/home/dockeruser/n8n-worker# nano Dockerfile
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose build --no-cache
postgres uses an image, skipping
pgadmin uses an image, skipping
redis uses an image, skipping
redis_admin uses an image, skipping
Building n8n
[+] Building 1.5s (6/6) FINISHED                                                                                                                                                               docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                     0.0s
 => => transferring dockerfile: 995B                                                                                                                                                                     0.0s
 => [internal] load metadata for docker.io/n8nio/n8n:latest                                                                                                                                              0.4s
 => [internal] load .dockerignore                                                                                                                                                                        0.0s
 => => transferring context: 2B                                                                                                                                                                          0.0s
 => CACHED [1/2] FROM docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                 0.0s
 => => resolve docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                        0.0s
 => [2/2] RUN echo '#!/bin/sh' > /usr/local/bin/start-n8n.sh &&     echo 'export HTTP_PROXY=http://10.132.222.73:9090' >> /usr/local/bin/start-n8n.sh &&     echo 'export HTTPS_PROXY=http://10.132.222  0.8s
 => exporting to image                                                                                                                                                                                   0.1s
 => => exporting layers                                                                                                                                                                                  0.1s
 => => writing image sha256:e3f554ff7e456788dc6feaca2ad39e81867ac880807657e57cb52b2d708bcd0f                                                                                                             0.0s
 => => naming to docker.io/library/n8n-worker_n8n                                                                                                                                                        0.0s
Building n8n_worker2
[+] Building 0.8s (6/6) FINISHED                                                                                                                                                               docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                     0.0s
 => => transferring dockerfile: 995B                                                                                                                                                                     0.0s
 => [internal] load metadata for docker.io/n8nio/n8n:latest                                                                                                                                              0.1s
 => [internal] load .dockerignore                                                                                                                                                                        0.0s
 => => transferring context: 2B                                                                                                                                                                          0.0s
 => CACHED [1/2] FROM docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                 0.0s
 => => resolve docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                        0.0s
 => [2/2] RUN echo '#!/bin/sh' > /usr/local/bin/start-n8n.sh &&     echo 'export HTTP_PROXY=http://10.132.222.73:9090' >> /usr/local/bin/start-n8n.sh &&     echo 'export HTTPS_PROXY=http://10.132.222  0.3s
 => exporting to image                                                                                                                                                                                   0.1s
 => => exporting layers                                                                                                                                                                                  0.1s
 => => writing image sha256:6e1a00f61e1de7e34a53b8e1b3e1960cf37937fd685621f583890e0f1073328b                                                                                                             0.0s
 => => naming to docker.io/library/n8n-worker_n8n_worker2                                                                                                                                                0.0s
Building n8n_worker1
[+] Building 0.8s (6/6) FINISHED                                                                                                                                                               docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                     0.0s
 => => transferring dockerfile: 995B                                                                                                                                                                     0.0s
 => [internal] load metadata for docker.io/n8nio/n8n:latest                                                                                                                                              0.1s
 => [internal] load .dockerignore                                                                                                                                                                        0.0s
 => => transferring context: 2B                                                                                                                                                                          0.0s
 => CACHED [1/2] FROM docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                 0.0s
 => => resolve docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                        0.0s
 => [2/2] RUN echo '#!/bin/sh' > /usr/local/bin/start-n8n.sh &&     echo 'export HTTP_PROXY=http://10.132.222.73:9090' >> /usr/local/bin/start-n8n.sh &&     echo 'export HTTPS_PROXY=http://10.132.222  0.3s
 => exporting to image                                                                                                                                                                                   0.1s
 => => exporting layers                                                                                                                                                                                  0.1s
 => => writing image sha256:22c386c3d90aad90fc9be1013a1c77d99c629a672eb70e346ff06f83b904bcf1                                                                                                             0.0s
 => => naming to docker.io/library/n8n-worker_n8n_worker1                                                                                                                                                0.0s
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose up -d
Creating network "n8n-worker_n8n_network" with driver "bridge"
Creating n8n_redis    ... done
Creating n8n_postgres ... done
Creating n8n_pgadmin  ... done
Creating n8n_redis_admin ... done
Creating n8n             ... done
Creating n8n_worker1     ... done
Creating n8n_worker2     ... done
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose logs -f n8n
Attaching to n8n
n8n            | 2025-10-14T22:51:41.073Z | debug | User settings loaded from: /home/node/.n8n/config {"file":"instance-settings.js","function":"loadOrCreate"}
n8n            | 2025-10-14T22:51:41.167Z | debug | Received CLI command {"execPath":"/usr/local/bin/node","scriptPath":"/usr/local/bin/n8n","args":[],"flags":{},"file":"cli-parser.js","function":"parse"}
n8n            | 2025-10-14T22:51:41.172Z | error | Last session crashed {"file":"crash-journal.js","function":"init"}
n8n            | 2025-10-14T22:51:51.177Z | info | Initializing n8n process {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:51.179Z | debug | Starting main instance in scaling mode {"scopes":["scaling"],"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:51.179Z | debug | Host ID: main-8959cc9ce03b {"scopes":["scaling"],"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:51.463Z | debug | Lazy-loading nodes and credentials from n8n-nodes-base {"nodes":483,"credentials":385,"file":"lazy-package-directory-loader.js","function":"loadAll"}
n8n            | 2025-10-14T22:51:51.480Z | debug | Lazy-loading nodes and credentials from @n8n/n8n-nodes-langchain {"nodes":102,"credentials":23,"file":"lazy-package-directory-loader.js","function":"loadAll"}
n8n            | 2025-10-14T22:51:51.826Z | info | n8n ready on ::, port 5678 {"file":"abstract-server.js","function":"init"}
n8n            | 2025-10-14T22:51:51.846Z | debug | Initializing AuthRolesService... {"file":"auth.roles.service.js","function":"init"}
n8n            | 2025-10-14T22:51:51.857Z | debug | No scopes to update. {"file":"auth.roles.service.js","function":"syncScopes"}
n8n            | 2025-10-14T22:51:51.878Z | debug | No global roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:51:51.879Z | debug | No project roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:51:51.879Z | debug | No credential roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:51:51.879Z | debug | No workflow roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:51:51.879Z | debug | AuthRolesService initialized successfully. {"file":"auth.roles.service.js","function":"init"}
n8n            | 2025-10-14T22:51:51.880Z | warn | Scaling mode is not officially supported with sqlite. Please use PostgreSQL instead. {"file":"base-command.js","function":"init"}
n8n            | 2025-10-14T22:51:51.891Z | debug | Started Redis client publisher(n8n) {"scopes":["redis","scaling"],"type":"publisher(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:51:51.924Z | info | n8n Task Broker ready on 127.0.0.1, port 5679 {"file":"task-broker-server.js","function":"setupHttpServer"}
n8n            | 2025-10-14T22:51:51.974Z | debug | Started Redis client cache(n8n) {"scopes":["redis","scaling"],"type":"cache(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:51:52.041Z | warn |
n8n            | There are deprecations related to your environment variables. Please take the recommended actions to update your configuration:
n8n            |  - DB_SQLITE_POOL_SIZE -> Running SQLite without a pool of read connections is deprecated. Please set `DB_SQLITE_POOL_SIZE` to a value higher than zero. See: https://docs.n8n.io/hosting/configuration/environment-variables/database/#sqlite
n8n            |  - N8N_BLOCK_ENV_ACCESS_IN_NODE -> The default value of N8N_BLOCK_ENV_ACCESS_IN_NODE will be changed from false to true in a future version. If you need to access environment variables from the Code Node or from expressions, please set N8N_BLOCK_ENV_ACCESS_IN_NODE=false. Learn more: https://docs.n8n.io/hosting/configuration/environment-variables/security/
n8n            |  - N8N_GIT_NODE_DISABLE_BARE_REPOS -> Support for bare repositories in the Git Node will be removed in a future version due to security concerns. If you are not using bare repositories in the Git Node, please set N8N_GIT_NODE_DISABLE_BARE_REPOS=true. Learn more: https://docs.n8n.io/hosting/configuration/environment-variables/security/
n8n            |  {"file":"deprecation.service.js","function":"warn"}
n8n            | 2025-10-14T22:51:52.048Z | debug | Registered a "reload-license" event handler on License#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.048Z | debug | Registered a "relay-execution-lifecycle-event" event handler on Push#handleRelayExecutionLifecycleEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.049Z | debug | Registered a "reload-overwrite-credentials" event handler on CredentialsOverwrites#reloadOverwriteCredentials {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.049Z | debug | Registered a "clear-test-webhooks" event handler on TestWebhooks#handleClearTestWebhooks {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.050Z | debug | Registered a "display-workflow-activation" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.050Z | debug | Registered a "display-workflow-deactivation" event handler on ActiveWorkflowManager#handleDisplayWorkflowDeactivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.051Z | debug | Registered a "display-workflow-activation-error" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivationError {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.051Z | debug | Registered a "add-webhooks-triggers-and-pollers" event handler on ActiveWorkflowManager#handleAddWebhooksTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.051Z | debug | Registered a "remove-triggers-and-pollers" event handler on ActiveWorkflowManager#handleRemoveTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.051Z | debug | Registered a "restart-event-bus" event handler on MessageEventBus#restart {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.052Z | debug | Registered a "response-to-get-worker-status" event handler on WorkerStatusService#handleWorkerStatusResponse {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.053Z | debug | Registered a "community-package-update" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.053Z | debug | Registered a "community-package-install" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.053Z | debug | Registered a "community-package-uninstall" event handler on CommunityPackagesService#handleUninstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:52.055Z | debug | Started Redis client subscriber(n8n) {"scopes":["redis","scaling"],"type":"subscriber(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:51:52.058Z | debug | Subscribed to channel n8n.commands {"scopes":["scaling","pubsub"],"file":"subscriber.service.js"}
n8n            | 2025-10-14T22:51:52.059Z | debug | Subscribed to channel n8n.worker-response {"scopes":["scaling","pubsub"],"file":"subscriber.service.js"}
n8n            | 2025-10-14T22:51:52.061Z | debug | [license SDK] initializing for deviceFingerprint e534fde58f3e53a0d28cbf6e83277281b82ee134a6f6e38802134cf2c2a5c9a9 {"scopes":["license"],"file":"LicenseManager.js","function":"log"}
n8n            | 2025-10-14T22:51:52.064Z | info | [license SDK] Skipping renewal on init: license cert is not initialized {"scopes":["license"],"file":"LicenseManager.js","function":"log"}
n8n            | 2025-10-14T22:51:52.065Z | debug | License initialized {"scopes":["license"],"file":"license.js","function":"init"}
n8n            | 2025-10-14T22:51:52.066Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}
n8n            | 2025-10-14T22:51:52.068Z | debug | Started tracking waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"startTracking"}
n8n            | 2025-10-14T22:51:52.069Z | debug | Wait tracker init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:52.069Z | debug | Loading overwrite credentials from static envvar {"file":"credentials-overwrites.js","function":"init"}
n8n            | 2025-10-14T22:51:52.070Z | debug | Credentials overwrites init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:52.073Z | debug | Binary data service init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:52.074Z | debug | Data deduplication service init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:52.075Z | debug | External hooks init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:52.075Z | debug | Workflow history init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:52.086Z | debug | Test runner cleanup complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:51:53.674Z | debug | Started flushing timer {"scopes":["insights"],"file":"insights-collection.service.js","function":"startFlushingTimer"}
n8n            | 2025-10-14T22:51:53.674Z | debug | Started compaction timer {"scopes":["insights"],"file":"insights-compaction.service.js","function":"startCompactionTimer"}
n8n            | 2025-10-14T22:51:53.676Z | debug | Started pruning timer {"scopes":["insights"],"file":"insights-pruning.service.js","function":"startPruningTimer"}
n8n            | 2025-10-14T22:51:53.676Z | debug | Initialized module "insights" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:51:53.677Z | debug | Skipped init for unlicensed module "external-secrets" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:51:53.681Z | debug | Initialized module "community-packages" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:51:53.703Z | debug | Initialized module "data-table" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:51:53.712Z | debug | Starting legacy SQLite execution recovery... {"scopes":["legacy-sqlite-execution-recovery"],"file":"legacy-sqlite-execution-recovery.service.js","function":"cleanupWorkflowExecutions"}
n8n            | 2025-10-14T22:51:53.715Z | debug | Legacy SQLite execution recovery completed. {"scopes":["legacy-sqlite-execution-recovery"],"file":"legacy-sqlite-execution-recovery.service.js","function":"cleanupWorkflowExecutions"}
n8n            | 2025-10-14T22:51:54.539Z | debug | Started Redis client client(bull) {"scopes":["redis","scaling"],"type":"client(bull)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:51:54.544Z | debug | Started Redis client subscriber(bull) {"scopes":["redis","scaling"],"type":"subscriber(bull)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:51:54.545Z | debug | Queue setup completed {"scopes":["scaling"],"file":"scaling.service.js","function":"setupQueue"}
n8n            | 2025-10-14T22:51:54.823Z | debug | Completed queue recovery check, no dangling executions {"scopes":["scaling"],"file":"scaling.service.js","function":"recoverFromQueue"}
n8n            | 2025-10-14T22:51:54.823Z | debug | Scheduled queue recovery check for next 180 min {"scopes":["scaling"],"file":"scaling.service.js","function":"scheduleQueueRecovery"}
n8n            | 2025-10-14T22:51:55.600Z | debug | OIDC login is disabled. {"file":"oidc.service.ee.js","function":"init"}
n8n            | 2025-10-14T22:51:55.606Z | info | Registered runner "JS Task Runner" (xC13RJrpLxoglsJhamIZr)  {"file":"task-broker-ws-server.js","function":"onMessage"}
n8n            | 2025-10-14T22:51:55.661Z | debug | Registered a "reload-license" event handler on License#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.662Z | debug | Registered a "relay-execution-lifecycle-event" event handler on Push#handleRelayExecutionLifecycleEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.662Z | debug | Registered a "reload-overwrite-credentials" event handler on CredentialsOverwrites#reloadOverwriteCredentials {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.662Z | debug | Registered a "clear-test-webhooks" event handler on TestWebhooks#handleClearTestWebhooks {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.662Z | debug | Registered a "display-workflow-activation" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.662Z | debug | Registered a "display-workflow-deactivation" event handler on ActiveWorkflowManager#handleDisplayWorkflowDeactivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.663Z | debug | Registered a "display-workflow-activation-error" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivationError {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.663Z | debug | Registered a "add-webhooks-triggers-and-pollers" event handler on ActiveWorkflowManager#handleAddWebhooksTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.663Z | debug | Registered a "remove-triggers-and-pollers" event handler on ActiveWorkflowManager#handleRemoveTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.663Z | debug | Registered a "restart-event-bus" event handler on MessageEventBus#restart {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.663Z | debug | Registered a "response-to-get-worker-status" event handler on WorkerStatusService#handleWorkerStatusResponse {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.664Z | debug | Registered a "community-package-update" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.664Z | debug | Registered a "community-package-install" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.664Z | debug | Registered a "community-package-uninstall" event handler on CommunityPackagesService#handleUninstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.664Z | debug | Registered a "reload-saml-config" event handler on SamlService#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.664Z | debug | Registered a "reload-oidc-config" event handler on OidcService#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:51:55.740Z | debug | Initializing event bus... {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:51:55.741Z | debug | Initializing event writer {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:51:55.745Z | debug | Checking for unsent event messages {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:51:55.801Z | debug | Start logging into /home/node/.n8n/n8nEventLog.log  {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:51:55.802Z | debug | MessageEventBus initialized {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:51:55.805Z | info | Version: 1.115.3 {"file":"abstract-server.js","function":"start"}
n8n            | 2025-10-14T22:51:55.805Z | debug | Server ID: main-8959cc9ce03b {"file":"server.js","function":"start"}
n8n            | 2025-10-14T22:51:55.809Z | debug | Soft-deletion every 60 minutes {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"scheduleRollingSoftDeletions"}
n8n            | 2025-10-14T22:51:55.810Z | debug | Hard-deletion in next 15 minutes {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"scheduleNextHardDeletion"}
n8n            | 2025-10-14T22:51:55.810Z | debug | Started pruning timers {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"startPruning"}
n8n            | 2025-10-14T22:51:55.816Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:51:55.821Z [Rudder] debug: no existing flush timer, creating new one
n8n            | (node:1) Warning: Setting the NODE_TLS_REJECT_UNAUTHORIZED environment variable to '0' makes TLS connections and HTTPS requests insecure by disabling certificate verification.
n8n            | (Use `node --trace-warnings ...` to show where the warning was created)
n8n            | 2025-10-14T22:51:55.869Z | info |
n8n            | Editor is now accessible via:
n8n            | http://localhost:5678 {"file":"base-command.js","function":"log"}
n8n            | 2025-10-14T22:51:55.933Z [Rudder] error: Response error code: ECONNREFUSED
n8n            | 2025-10-14T22:51:56.146Z [Rudder] error: Response error code: ECONNREFUSED
n8n            | 2025-10-14T22:51:56.599Z [Rudder] error: Response error code: ECONNREFUSED
n8n            | 2025-10-14T22:51:57.531Z [Rudder] error: Error: ECONNREFUSED
n8n            | 2025-10-14T22:51:57.532Z | error | connect ECONNREFUSED 172.67.68.102:443 {"file":"error-reporter.js","function":"defaultReport"}
n8n            | 2025-10-14T22:51:57.532Z | error | connect ECONNREFUSED 172.67.68.102:443 {"file":"error-reporter.js","function":"defaultReport"}
n8n            | 2025-10-14T22:52:05.822Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:52:05.822Z [Rudder] debug: cancelling existing flushTimer...
n8n            | 2025-10-14T22:52:05.823Z | error | connect ECONNREFUSED 172.67.68.102:443 {"file":"error-reporter.js","function":"defaultReport"}
n8n            | 2025-10-14T22:52:05.824Z | error | connect ECONNREFUSED 172.67.68.102:443 {"file":"error-reporter.js","function":"defaultReport"}
n8n            | Error fetching feature flags Error [PostHogFetchNetworkError]: Network error while fetching PostHog
n8n            |     at new PostHogFetchNetworkError (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/posthog-core/src/index.ts:41:5)
n8n            |     at PostHog.<anonymous> (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/posthog-core/src/index.ts:546:17)
n8n            |     at step (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/node_modules/tslib/tslib.es6.js:102:23)
n8n            |     at Object.throw (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/node_modules/tslib/tslib.es6.js:83:53)
n8n            |     at rejected (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/node_modules/tslib/tslib.es6.js:74:65)
n8n            |     at processTicksAndRejections (node:internal/process/task_queues:105:5) {
n8n            |   error: TypeError: fetch failed
n8n            |       at node:internal/deps/undici/undici:13510:13
n8n            |       at processTicksAndRejections (node:internal/process/task_queues:105:5) {
n8n            |     [cause]: Error: connect ECONNREFUSED 172.67.68.102:443
n8n            |         at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
n8n            |       errno: -111,
n8n            |       code: 'ECONNREFUSED',
n8n            |       syscall: 'connect',
n8n            |       address: '172.67.68.102',
n8n            |       port: 443
n8n            |     }
n8n            |   },
n8n            |   [cause]: TypeError: fetch failed
n8n            |       at node:internal/deps/undici/undici:13510:13
n8n            |       at processTicksAndRejections (node:internal/process/task_queues:105:5) {
n8n            |     [cause]: Error: connect ECONNREFUSED 172.67.68.102:443
n8n            |         at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
n8n            |       errno: -111,
n8n            |       code: 'ECONNREFUSED',
n8n            |       syscall: 'connect',
n8n            |       address: '172.67.68.102',
n8n            |       port: 443
n8n            |     }
n8n            |   }
n8n            | }
n8n            | 2025-10-14T22:52:17.744Z | debug | Skipped browserId check on /rest/push {"file":"auth.service.js","function":"resolveJwt"}
n8n            | 2025-10-14T22:52:17.746Z | debug | Add editor-UI session {"pushRef":"6az9icp1mw","file":"abstract.push.js","function":"add"}
n8n            | 2025-10-14T22:52:23.535Z | debug | Execution added {"executionId":"6","file":"active-executions.js","function":"add"}
n8n            | 2025-10-14T22:52:23.549Z | info | Enqueued execution 6 (job 6) {"scopes":["scaling"],"executionId":"6","jobId":"6","file":"scaling.service.js","function":"addJob"}
n8n            | 2025-10-14T22:52:24.345Z | debug | Received pubsub msg: relay-execution-lifecycle-event (executionStarted) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"executionStarted","executionId":"6","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:52:24.346Z | debug | Pushed to frontend: executionStarted {"dataType":"executionStarted","pushRefs":"6az9icp1mw","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:52:24.349Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteBefore) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteBefore","executionId":"6","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:52:24.349Z | debug | Pushed to frontend: nodeExecuteBefore {"dataType":"nodeExecuteBefore","pushRefs":"6az9icp1mw","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:52:24.573Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteBefore) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteBefore","executionId":"6","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:52:24.573Z | debug | Pushed to frontend: nodeExecuteBefore {"dataType":"nodeExecuteBefore","pushRefs":"6az9icp1mw","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:52:24.576Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteAfter) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteAfter","executionId":"6","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:52:24.577Z | debug | Pushed to frontend: nodeExecuteAfter {"dataType":"nodeExecuteAfter","pushRefs":"6az9icp1mw","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:52:24.577Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteAfterData) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteAfterData","executionId":"6","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:52:24.577Z | debug | Pushed to frontend: nodeExecuteAfterData {"dataType":"nodeExecuteAfterData","pushRefs":"6az9icp1mw","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:52:25.816Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteBefore) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteBefore","executionId":"6","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:52:25.816Z | debug | Pushed to frontend: nodeExecuteBefore {"dataType":"nodeExecuteBefore","pushRefs":"6az9icp1mw","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:52:52.066Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}




+++++++++++++++++++++++++++++++


FROM n8nio/n8n:latest

USER root

# Crear el script de inicio
RUN echo '#!/bin/sh' > /usr/local/bin/start-n8n.sh && \
    echo 'export HTTP_PROXY=http://10.132.222.73:9090' >> /usr/local/bin/start-n8n.sh && \
    echo 'export HTTPS_PROXY=http://10.132.222.73:9090' >> /usr/local/bin/start-n8n.sh && \
    echo 'export http_proxy=http://10.132.222.73:9090' >> /usr/local/bin/start-n8n.sh && \
    echo 'export https_proxy=http://10.132.222.73:9090' >> /usr/local/bin/start-n8n.sh && \
    echo 'export NO_PROXY=localhost,127.0.0.1,postgres,redis' >> /usr/local/bin/start-n8n.sh && \
    echo 'export no_proxy=localhost,127.0.0.1,postgres,redis' >> /usr/local/bin/start-n8n.sh && \
    echo 'export NODE_TLS_REJECT_UNAUTHORIZED=0' >> /usr/local/bin/start-n8n.sh && \
    echo 'exec /usr/local/bin/n8n "$@"' >> /usr/local/bin/start-n8n.sh && \
    chmod +x /usr/local/bin/start-n8n.sh

USER node

ENTRYPOINT ["/usr/local/bin/start-n8n.sh"]


+++++++++++++++
root@sapl8464:/home/dockeruser/n8n-worker# nano Dockerfile
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose build --no-cache
postgres uses an image, skipping
pgadmin uses an image, skipping
redis uses an image, skipping
redis_admin uses an image, skipping
Building n8n
[+] Building 1.7s (8/8) FINISHED                                                                                                                                                               docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                     0.0s
 => => transferring dockerfile: 696B                                                                                                                                                                     0.0s
 => [internal] load metadata for docker.io/n8nio/n8n:latest                                                                                                                                              0.6s
 => [auth] n8nio/n8n:pull token for registry-1.docker.io                                                                                                                                                 0.0s
 => [internal] load .dockerignore                                                                                                                                                                        0.0s
 => => transferring context: 2B                                                                                                                                                                          0.0s
 => CACHED [1/3] FROM docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                 0.0s
 => => resolve docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                        0.0s
 => [2/3] RUN cat > /usr/local/bin/start-n8n.sh << 'EOF'                                                                                                                                                 0.3s
 => [3/3] RUN chmod +x /usr/local/bin/start-n8n.sh                                                                                                                                                       0.4s
 => exporting to image                                                                                                                                                                                   0.1s
 => => exporting layers                                                                                                                                                                                  0.1s
 => => writing image sha256:849f8fbcc37e71e85f220e00b5343e9e8832d83bc4a3517f9b0ce3b66a8e2971                                                                                                             0.0s
 => => naming to docker.io/library/n8n-worker_n8n                                                                                                                                                        0.0s
Building n8n_worker2
[+] Building 1.2s (7/7) FINISHED                                                                                                                                                               docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                     0.0s
 => => transferring dockerfile: 696B                                                                                                                                                                     0.0s
 => [internal] load metadata for docker.io/n8nio/n8n:latest                                                                                                                                              0.1s
 => [internal] load .dockerignore                                                                                                                                                                        0.0s
 => => transferring context: 2B                                                                                                                                                                          0.0s
 => CACHED [1/3] FROM docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                 0.0s
 => => resolve docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                        0.0s
 => [2/3] RUN cat > /usr/local/bin/start-n8n.sh << 'EOF'                                                                                                                                                 0.3s
 => [3/3] RUN chmod +x /usr/local/bin/start-n8n.sh                                                                                                                                                       0.4s
 => exporting to image                                                                                                                                                                                   0.1s
 => => exporting layers                                                                                                                                                                                  0.1s
 => => writing image sha256:37ad214fe6de4cf7f1b7bfbe8d39d9aedc405396b1456086b26de652c033887a                                                                                                             0.0s
 => => naming to docker.io/library/n8n-worker_n8n_worker2                                                                                                                                                0.0s
Building n8n_worker1
[+] Building 1.2s (7/7) FINISHED                                                                                                                                                               docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                     0.0s
 => => transferring dockerfile: 696B                                                                                                                                                                     0.0s
 => [internal] load metadata for docker.io/n8nio/n8n:latest                                                                                                                                              0.1s
 => [internal] load .dockerignore                                                                                                                                                                        0.0s
 => => transferring context: 2B                                                                                                                                                                          0.0s
 => CACHED [1/3] FROM docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                 0.0s
 => => resolve docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                        0.0s
 => [2/3] RUN cat > /usr/local/bin/start-n8n.sh << 'EOF'                                                                                                                                                 0.3s
 => [3/3] RUN chmod +x /usr/local/bin/start-n8n.sh                                                                                                                                                       0.3s
 => exporting to image                                                                                                                                                                                   0.1s
 => => exporting layers                                                                                                                                                                                  0.1s
 => => writing image sha256:d7ce40acb31e11ba606083db6b150551f46d2c070b94b10330bd3b76a6b70625                                                                                                             0.0s
 => => naming to docker.io/library/n8n-worker_n8n_worker1                                                                                                                                                0.0s
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose up -d
Creating network "n8n-worker_n8n_network" with driver "bridge"
Creating n8n_postgres ... done
Creating n8n_redis    ... done
Creating n8n_pgadmin  ... done
Creating n8n             ... done
Creating n8n_redis_admin ... done
Creating n8n_worker2     ... done
Creating n8n_worker1     ... done
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose logs -f n8n
Attaching to n8n
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory
n8n            | exec /usr/local/bin/start-n8n.sh: no such file or directory



++++++++++++++++++++



FROM n8nio/n8n:latest

USER root

# Script que solo exporta variables de entorno
RUN cat > /usr/local/bin/start-n8n.sh << 'EOF'
#!/bin/sh
export HTTP_PROXY=http://10.132.222.73:9090
export HTTPS_PROXY=http://10.132.222.73:9090
export http_proxy=http://10.132.222.73:9090
export https_proxy=http://10.132.222.73:9090
export NO_PROXY=localhost,127.0.0.1,postgres,redis
export no_proxy=localhost,127.0.0.1,postgres,redis
export NODE_TLS_REJECT_UNAUTHORIZED=0

# Forzar que Node.js use el proxy del sistema
exec /usr/local/bin/n8n "$@"
EOF

RUN chmod +x /usr/local/bin/start-n8n.sh

USER node

ENTRYPOINT ["/usr/local/bin/start-n8n.sh"]





++++++++++++

oot@sapl8464:/home/dockeruser/n8n-worker# docker-compose logs -f n8n
Attaching to n8n
n8n            | 2025-10-14T22:36:45.900Z | debug | User settings loaded from: /home/node/.n8n/config {"file":"instance-settings.js","function":"loadOrCreate"}
n8n            | 2025-10-14T22:36:45.990Z | debug | Received CLI command {"execPath":"/usr/local/bin/node","scriptPath":"/usr/local/bin/n8n","args":[],"flags":{},"file":"cli-parser.js","function":"parse"}
n8n            | 2025-10-14T22:36:45.995Z | error | Last session crashed {"file":"crash-journal.js","function":"init"}
n8n            | 2025-10-14T22:36:55.999Z | info | Initializing n8n process {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.001Z | debug | Starting main instance in scaling mode {"scopes":["scaling"],"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.001Z | debug | Host ID: main-17acdc739da8 {"scopes":["scaling"],"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.295Z | debug | Lazy-loading nodes and credentials from n8n-nodes-base {"nodes":483,"credentials":385,"file":"lazy-package-directory-loader.js","function":"loadAll"}
n8n            | 2025-10-14T22:36:56.313Z | debug | Lazy-loading nodes and credentials from @n8n/n8n-nodes-langchain {"nodes":102,"credentials":23,"file":"lazy-package-directory-loader.js","function":"loadAll"}
n8n            | 2025-10-14T22:36:56.671Z | info | n8n ready on ::, port 5678 {"file":"abstract-server.js","function":"init"}
n8n            | 2025-10-14T22:36:56.690Z | debug | Initializing AuthRolesService... {"file":"auth.roles.service.js","function":"init"}
n8n            | 2025-10-14T22:36:56.701Z | debug | No scopes to update. {"file":"auth.roles.service.js","function":"syncScopes"}
n8n            | 2025-10-14T22:36:56.721Z | debug | No global roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.721Z | debug | No project roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.721Z | debug | No credential roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.722Z | debug | No workflow roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.722Z | debug | AuthRolesService initialized successfully. {"file":"auth.roles.service.js","function":"init"}
n8n            | 2025-10-14T22:36:56.722Z | warn | Scaling mode is not officially supported with sqlite. Please use PostgreSQL instead. {"file":"base-command.js","function":"init"}
n8n            | 2025-10-14T22:36:56.734Z | debug | Started Redis client publisher(n8n) {"scopes":["redis","scaling"],"type":"publisher(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:56.767Z | info | n8n Task Broker ready on 127.0.0.1, port 5679 {"file":"task-broker-server.js","function":"setupHttpServer"}
n8n            | 2025-10-14T22:36:56.817Z | debug | Started Redis client cache(n8n) {"scopes":["redis","scaling"],"type":"cache(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:56.885Z | warn |
n8n            | There are deprecations related to your environment variables. Please take the recommended actions to update your configuration:
n8n            |  - DB_SQLITE_POOL_SIZE -> Running SQLite without a pool of read connections is deprecated. Please set `DB_SQLITE_POOL_SIZE` to a value higher than zero. See: https://docs.n8n.io/hosting/configuration/environment-variables/database/#sqlite
n8n            |  - N8N_BLOCK_ENV_ACCESS_IN_NODE -> The default value of N8N_BLOCK_ENV_ACCESS_IN_NODE will be changed from false to true in a future version. If you need to access environment variables from the Code Node or from expressions, please set N8N_BLOCK_ENV_ACCESS_IN_NODE=false. Learn more: https://docs.n8n.io/hosting/configuration/environment-variables/security/
n8n            |  - N8N_GIT_NODE_DISABLE_BARE_REPOS -> Support for bare repositories in the Git Node will be removed in a future version due to security concerns. If you are not using bare repositories in the Git Node, please set N8N_GIT_NODE_DISABLE_BARE_REPOS=true. Learn more: https://docs.n8n.io/hosting/configuration/environment-variables/security/
n8n            |  {"file":"deprecation.service.js","function":"warn"}
n8n            | 2025-10-14T22:36:56.893Z | debug | Registered a "reload-license" event handler on License#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.894Z | debug | Registered a "relay-execution-lifecycle-event" event handler on Push#handleRelayExecutionLifecycleEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.894Z | debug | Registered a "reload-overwrite-credentials" event handler on CredentialsOverwrites#reloadOverwriteCredentials {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.894Z | debug | Registered a "clear-test-webhooks" event handler on TestWebhooks#handleClearTestWebhooks {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "display-workflow-activation" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "display-workflow-deactivation" event handler on ActiveWorkflowManager#handleDisplayWorkflowDeactivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "display-workflow-activation-error" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivationError {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "add-webhooks-triggers-and-pollers" event handler on ActiveWorkflowManager#handleAddWebhooksTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.896Z | debug | Registered a "remove-triggers-and-pollers" event handler on ActiveWorkflowManager#handleRemoveTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.896Z | debug | Registered a "restart-event-bus" event handler on MessageEventBus#restart {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.897Z | debug | Registered a "response-to-get-worker-status" event handler on WorkerStatusService#handleWorkerStatusResponse {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.897Z | debug | Registered a "community-package-update" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.898Z | debug | Registered a "community-package-install" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.898Z | debug | Registered a "community-package-uninstall" event handler on CommunityPackagesService#handleUninstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.899Z | debug | Started Redis client subscriber(n8n) {"scopes":["redis","scaling"],"type":"subscriber(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:56.920Z | debug | Subscribed to channel n8n.commands {"scopes":["scaling","pubsub"],"file":"subscriber.service.js"}
n8n            | 2025-10-14T22:36:56.922Z | debug | Subscribed to channel n8n.worker-response {"scopes":["scaling","pubsub"],"file":"subscriber.service.js"}
n8n            | 2025-10-14T22:36:56.924Z | debug | [license SDK] initializing for deviceFingerprint e534fde58f3e53a0d28cbf6e83277281b82ee134a6f6e38802134cf2c2a5c9a9 {"scopes":["license"],"file":"LicenseManager.js","function":"log"}
n8n            | 2025-10-14T22:36:56.928Z | info | [license SDK] Skipping renewal on init: license cert is not initialized {"scopes":["license"],"file":"LicenseManager.js","function":"log"}
n8n            | 2025-10-14T22:36:56.929Z | debug | License initialized {"scopes":["license"],"file":"license.js","function":"init"}
n8n            | 2025-10-14T22:36:56.929Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}
n8n            | 2025-10-14T22:36:56.933Z | debug | Started tracking waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"startTracking"}
n8n            | 2025-10-14T22:36:56.933Z | debug | Wait tracker init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.933Z | debug | Loading overwrite credentials from static envvar {"file":"credentials-overwrites.js","function":"init"}
n8n            | 2025-10-14T22:36:56.934Z | debug | Credentials overwrites init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.939Z | debug | Binary data service init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.940Z | debug | Data deduplication service init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.940Z | debug | External hooks init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.941Z | debug | Workflow history init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.951Z | debug | Test runner cleanup complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:58.519Z | debug | Started flushing timer {"scopes":["insights"],"file":"insights-collection.service.js","function":"startFlushingTimer"}
n8n            | 2025-10-14T22:36:58.519Z | debug | Started compaction timer {"scopes":["insights"],"file":"insights-compaction.service.js","function":"startCompactionTimer"}
n8n            | 2025-10-14T22:36:58.520Z | debug | Started pruning timer {"scopes":["insights"],"file":"insights-pruning.service.js","function":"startPruningTimer"}
n8n            | 2025-10-14T22:36:58.520Z | debug | Initialized module "insights" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.521Z | debug | Skipped init for unlicensed module "external-secrets" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.525Z | debug | Initialized module "community-packages" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.548Z | debug | Initialized module "data-table" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.556Z | debug | Starting legacy SQLite execution recovery... {"scopes":["legacy-sqlite-execution-recovery"],"file":"legacy-sqlite-execution-recovery.service.js","function":"cleanupWorkflowExecutions"}
n8n            | 2025-10-14T22:36:58.558Z | debug | Legacy SQLite execution recovery completed. {"scopes":["legacy-sqlite-execution-recovery"],"file":"legacy-sqlite-execution-recovery.service.js","function":"cleanupWorkflowExecutions"}
n8n            | 2025-10-14T22:36:59.400Z | debug | Started Redis client client(bull) {"scopes":["redis","scaling"],"type":"client(bull)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:59.405Z | debug | Started Redis client subscriber(bull) {"scopes":["redis","scaling"],"type":"subscriber(bull)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:59.406Z | debug | Queue setup completed {"scopes":["scaling"],"file":"scaling.service.js","function":"setupQueue"}
n8n            | 2025-10-14T22:36:59.722Z | debug | Completed queue recovery check, no dangling executions {"scopes":["scaling"],"file":"scaling.service.js","function":"recoverFromQueue"}
n8n            | 2025-10-14T22:36:59.723Z | debug | Scheduled queue recovery check for next 180 min {"scopes":["scaling"],"file":"scaling.service.js","function":"scheduleQueueRecovery"}
n8n            | 2025-10-14T22:37:00.533Z | debug | OIDC login is disabled. {"file":"oidc.service.ee.js","function":"init"}
n8n            | 2025-10-14T22:37:00.540Z | info | Registered runner "JS Task Runner" (KolhcMbttmhfUEAToqjLX)  {"file":"task-broker-ws-server.js","function":"onMessage"}
n8n            | 2025-10-14T22:37:00.589Z | debug | Registered a "reload-license" event handler on License#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.589Z | debug | Registered a "relay-execution-lifecycle-event" event handler on Push#handleRelayExecutionLifecycleEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "reload-overwrite-credentials" event handler on CredentialsOverwrites#reloadOverwriteCredentials {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "clear-test-webhooks" event handler on TestWebhooks#handleClearTestWebhooks {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "display-workflow-activation" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "display-workflow-deactivation" event handler on ActiveWorkflowManager#handleDisplayWorkflowDeactivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "display-workflow-activation-error" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivationError {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "add-webhooks-triggers-and-pollers" event handler on ActiveWorkflowManager#handleAddWebhooksTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "remove-triggers-and-pollers" event handler on ActiveWorkflowManager#handleRemoveTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "restart-event-bus" event handler on MessageEventBus#restart {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "response-to-get-worker-status" event handler on WorkerStatusService#handleWorkerStatusResponse {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "community-package-update" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "community-package-install" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "community-package-uninstall" event handler on CommunityPackagesService#handleUninstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "reload-saml-config" event handler on SamlService#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "reload-oidc-config" event handler on OidcService#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.661Z | debug | Initializing event bus... {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.663Z | debug | Initializing event writer {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.667Z | debug | Checking for unsent event messages {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.729Z | debug | Start logging into /home/node/.n8n/n8nEventLog.log  {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.730Z | debug | MessageEventBus initialized {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.733Z | info | Version: 1.115.3 {"file":"abstract-server.js","function":"start"}
n8n            | 2025-10-14T22:37:00.733Z | debug | Server ID: main-17acdc739da8 {"file":"server.js","function":"start"}
n8n            | 2025-10-14T22:37:00.738Z | debug | Soft-deletion every 60 minutes {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"scheduleRollingSoftDeletions"}
n8n            | 2025-10-14T22:37:00.739Z | debug | Hard-deletion in next 15 minutes {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"scheduleNextHardDeletion"}
n8n            | 2025-10-14T22:37:00.739Z | debug | Started pruning timers {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"startPruning"}
n8n            | 2025-10-14T22:37:00.744Z | error | Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload {"file":"error-reporter.js","function":"defaultReport"}
n8n            | 2025-10-14T22:37:00.749Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:37:00.753Z [Rudder] debug: no existing flush timer, creating new one
n8n            | 2025-10-14T22:37:00.772Z | info |
n8n            | Editor is now accessible via:
n8n            | http://localhost:5678 {"file":"base-command.js","function":"log"}
n8n            | (node:1) Warning: Setting the NODE_TLS_REJECT_UNAUTHORIZED environment variable to '0' makes TLS connections and HTTPS requests insecure by disabling certificate verification.
n8n            | (Use `node --trace-warnings ...` to show where the warning was created)
n8n            | 2025-10-14T22:37:10.754Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:37:10.754Z [Rudder] debug: cancelling existing flushTimer...
n8n            | 2025-10-14T22:37:12.877Z | debug | Skipped browserId check on /rest/push {"file":"auth.service.js","function":"resolveJwt"}
n8n            | 2025-10-14T22:37:12.881Z | debug | Add editor-UI session {"pushRef":"j1hsor5v9h","file":"abstract.push.js","function":"add"}
^CERROR: Aborting.
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose logs -f n8n
Attaching to n8n
n8n            | 2025-10-14T22:36:45.900Z | debug | User settings loaded from: /home/node/.n8n/config {"file":"instance-settings.js","function":"loadOrCreate"}
n8n            | 2025-10-14T22:36:45.990Z | debug | Received CLI command {"execPath":"/usr/local/bin/node","scriptPath":"/usr/local/bin/n8n","args":[],"flags":{},"file":"cli-parser.js","function":"parse"}
n8n            | 2025-10-14T22:36:45.995Z | error | Last session crashed {"file":"crash-journal.js","function":"init"}
n8n            | 2025-10-14T22:36:55.999Z | info | Initializing n8n process {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.001Z | debug | Starting main instance in scaling mode {"scopes":["scaling"],"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.001Z | debug | Host ID: main-17acdc739da8 {"scopes":["scaling"],"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.295Z | debug | Lazy-loading nodes and credentials from n8n-nodes-base {"nodes":483,"credentials":385,"file":"lazy-package-directory-loader.js","function":"loadAll"}
n8n            | 2025-10-14T22:36:56.313Z | debug | Lazy-loading nodes and credentials from @n8n/n8n-nodes-langchain {"nodes":102,"credentials":23,"file":"lazy-package-directory-loader.js","function":"loadAll"}
n8n            | 2025-10-14T22:36:56.671Z | info | n8n ready on ::, port 5678 {"file":"abstract-server.js","function":"init"}
n8n            | 2025-10-14T22:36:56.690Z | debug | Initializing AuthRolesService... {"file":"auth.roles.service.js","function":"init"}
n8n            | 2025-10-14T22:36:56.701Z | debug | No scopes to update. {"file":"auth.roles.service.js","function":"syncScopes"}
n8n            | 2025-10-14T22:36:56.721Z | debug | No global roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.721Z | debug | No project roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.721Z | debug | No credential roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.722Z | debug | No workflow roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.722Z | debug | AuthRolesService initialized successfully. {"file":"auth.roles.service.js","function":"init"}
n8n            | 2025-10-14T22:36:56.722Z | warn | Scaling mode is not officially supported with sqlite. Please use PostgreSQL instead. {"file":"base-command.js","function":"init"}
n8n            | 2025-10-14T22:36:56.734Z | debug | Started Redis client publisher(n8n) {"scopes":["redis","scaling"],"type":"publisher(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:56.767Z | info | n8n Task Broker ready on 127.0.0.1, port 5679 {"file":"task-broker-server.js","function":"setupHttpServer"}
n8n            | 2025-10-14T22:36:56.817Z | debug | Started Redis client cache(n8n) {"scopes":["redis","scaling"],"type":"cache(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:56.885Z | warn |
n8n            | There are deprecations related to your environment variables. Please take the recommended actions to update your configuration:
n8n            |  - DB_SQLITE_POOL_SIZE -> Running SQLite without a pool of read connections is deprecated. Please set `DB_SQLITE_POOL_SIZE` to a value higher than zero. See: https://docs.n8n.io/hosting/configuration/environment-variables/database/#sqlite
n8n            |  - N8N_BLOCK_ENV_ACCESS_IN_NODE -> The default value of N8N_BLOCK_ENV_ACCESS_IN_NODE will be changed from false to true in a future version. If you need to access environment variables from the Code Node or from expressions, please set N8N_BLOCK_ENV_ACCESS_IN_NODE=false. Learn more: https://docs.n8n.io/hosting/configuration/environment-variables/security/
n8n            |  - N8N_GIT_NODE_DISABLE_BARE_REPOS -> Support for bare repositories in the Git Node will be removed in a future version due to security concerns. If you are not using bare repositories in the Git Node, please set N8N_GIT_NODE_DISABLE_BARE_REPOS=true. Learn more: https://docs.n8n.io/hosting/configuration/environment-variables/security/
n8n            |  {"file":"deprecation.service.js","function":"warn"}
n8n            | 2025-10-14T22:36:56.893Z | debug | Registered a "reload-license" event handler on License#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.894Z | debug | Registered a "relay-execution-lifecycle-event" event handler on Push#handleRelayExecutionLifecycleEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.894Z | debug | Registered a "reload-overwrite-credentials" event handler on CredentialsOverwrites#reloadOverwriteCredentials {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.894Z | debug | Registered a "clear-test-webhooks" event handler on TestWebhooks#handleClearTestWebhooks {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "display-workflow-activation" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "display-workflow-deactivation" event handler on ActiveWorkflowManager#handleDisplayWorkflowDeactivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "display-workflow-activation-error" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivationError {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "add-webhooks-triggers-and-pollers" event handler on ActiveWorkflowManager#handleAddWebhooksTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.896Z | debug | Registered a "remove-triggers-and-pollers" event handler on ActiveWorkflowManager#handleRemoveTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.896Z | debug | Registered a "restart-event-bus" event handler on MessageEventBus#restart {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.897Z | debug | Registered a "response-to-get-worker-status" event handler on WorkerStatusService#handleWorkerStatusResponse {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.897Z | debug | Registered a "community-package-update" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.898Z | debug | Registered a "community-package-install" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.898Z | debug | Registered a "community-package-uninstall" event handler on CommunityPackagesService#handleUninstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.899Z | debug | Started Redis client subscriber(n8n) {"scopes":["redis","scaling"],"type":"subscriber(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:56.920Z | debug | Subscribed to channel n8n.commands {"scopes":["scaling","pubsub"],"file":"subscriber.service.js"}
n8n            | 2025-10-14T22:36:56.922Z | debug | Subscribed to channel n8n.worker-response {"scopes":["scaling","pubsub"],"file":"subscriber.service.js"}
n8n            | 2025-10-14T22:36:56.924Z | debug | [license SDK] initializing for deviceFingerprint e534fde58f3e53a0d28cbf6e83277281b82ee134a6f6e38802134cf2c2a5c9a9 {"scopes":["license"],"file":"LicenseManager.js","function":"log"}
n8n            | 2025-10-14T22:36:56.928Z | info | [license SDK] Skipping renewal on init: license cert is not initialized {"scopes":["license"],"file":"LicenseManager.js","function":"log"}
n8n            | 2025-10-14T22:36:56.929Z | debug | License initialized {"scopes":["license"],"file":"license.js","function":"init"}
n8n            | 2025-10-14T22:36:56.929Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}
n8n            | 2025-10-14T22:36:56.933Z | debug | Started tracking waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"startTracking"}
n8n            | 2025-10-14T22:36:56.933Z | debug | Wait tracker init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.933Z | debug | Loading overwrite credentials from static envvar {"file":"credentials-overwrites.js","function":"init"}
n8n            | 2025-10-14T22:36:56.934Z | debug | Credentials overwrites init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.939Z | debug | Binary data service init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.940Z | debug | Data deduplication service init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.940Z | debug | External hooks init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.941Z | debug | Workflow history init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.951Z | debug | Test runner cleanup complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:58.519Z | debug | Started flushing timer {"scopes":["insights"],"file":"insights-collection.service.js","function":"startFlushingTimer"}
n8n            | 2025-10-14T22:36:58.519Z | debug | Started compaction timer {"scopes":["insights"],"file":"insights-compaction.service.js","function":"startCompactionTimer"}
n8n            | 2025-10-14T22:36:58.520Z | debug | Started pruning timer {"scopes":["insights"],"file":"insights-pruning.service.js","function":"startPruningTimer"}
n8n            | 2025-10-14T22:36:58.520Z | debug | Initialized module "insights" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.521Z | debug | Skipped init for unlicensed module "external-secrets" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.525Z | debug | Initialized module "community-packages" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.548Z | debug | Initialized module "data-table" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.556Z | debug | Starting legacy SQLite execution recovery... {"scopes":["legacy-sqlite-execution-recovery"],"file":"legacy-sqlite-execution-recovery.service.js","function":"cleanupWorkflowExecutions"}
n8n            | 2025-10-14T22:36:58.558Z | debug | Legacy SQLite execution recovery completed. {"scopes":["legacy-sqlite-execution-recovery"],"file":"legacy-sqlite-execution-recovery.service.js","function":"cleanupWorkflowExecutions"}
n8n            | 2025-10-14T22:36:59.400Z | debug | Started Redis client client(bull) {"scopes":["redis","scaling"],"type":"client(bull)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:59.405Z | debug | Started Redis client subscriber(bull) {"scopes":["redis","scaling"],"type":"subscriber(bull)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:59.406Z | debug | Queue setup completed {"scopes":["scaling"],"file":"scaling.service.js","function":"setupQueue"}
n8n            | 2025-10-14T22:36:59.722Z | debug | Completed queue recovery check, no dangling executions {"scopes":["scaling"],"file":"scaling.service.js","function":"recoverFromQueue"}
n8n            | 2025-10-14T22:36:59.723Z | debug | Scheduled queue recovery check for next 180 min {"scopes":["scaling"],"file":"scaling.service.js","function":"scheduleQueueRecovery"}
n8n            | 2025-10-14T22:37:00.533Z | debug | OIDC login is disabled. {"file":"oidc.service.ee.js","function":"init"}
n8n            | 2025-10-14T22:37:00.540Z | info | Registered runner "JS Task Runner" (KolhcMbttmhfUEAToqjLX)  {"file":"task-broker-ws-server.js","function":"onMessage"}
n8n            | 2025-10-14T22:37:00.589Z | debug | Registered a "reload-license" event handler on License#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.589Z | debug | Registered a "relay-execution-lifecycle-event" event handler on Push#handleRelayExecutionLifecycleEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "reload-overwrite-credentials" event handler on CredentialsOverwrites#reloadOverwriteCredentials {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "clear-test-webhooks" event handler on TestWebhooks#handleClearTestWebhooks {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "display-workflow-activation" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "display-workflow-deactivation" event handler on ActiveWorkflowManager#handleDisplayWorkflowDeactivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "display-workflow-activation-error" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivationError {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "add-webhooks-triggers-and-pollers" event handler on ActiveWorkflowManager#handleAddWebhooksTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "remove-triggers-and-pollers" event handler on ActiveWorkflowManager#handleRemoveTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "restart-event-bus" event handler on MessageEventBus#restart {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "response-to-get-worker-status" event handler on WorkerStatusService#handleWorkerStatusResponse {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "community-package-update" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "community-package-install" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "community-package-uninstall" event handler on CommunityPackagesService#handleUninstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "reload-saml-config" event handler on SamlService#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "reload-oidc-config" event handler on OidcService#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.661Z | debug | Initializing event bus... {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.663Z | debug | Initializing event writer {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.667Z | debug | Checking for unsent event messages {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.729Z | debug | Start logging into /home/node/.n8n/n8nEventLog.log  {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.730Z | debug | MessageEventBus initialized {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.733Z | info | Version: 1.115.3 {"file":"abstract-server.js","function":"start"}
n8n            | 2025-10-14T22:37:00.733Z | debug | Server ID: main-17acdc739da8 {"file":"server.js","function":"start"}
n8n            | 2025-10-14T22:37:00.738Z | debug | Soft-deletion every 60 minutes {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"scheduleRollingSoftDeletions"}
n8n            | 2025-10-14T22:37:00.739Z | debug | Hard-deletion in next 15 minutes {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"scheduleNextHardDeletion"}
n8n            | 2025-10-14T22:37:00.739Z | debug | Started pruning timers {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"startPruning"}
n8n            | 2025-10-14T22:37:00.744Z | error | Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload {"file":"error-reporter.js","function":"defaultReport"}
n8n            | 2025-10-14T22:37:00.749Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:37:00.753Z [Rudder] debug: no existing flush timer, creating new one
n8n            | 2025-10-14T22:37:00.772Z | info |
n8n            | Editor is now accessible via:
n8n            | http://localhost:5678 {"file":"base-command.js","function":"log"}
n8n            | (node:1) Warning: Setting the NODE_TLS_REJECT_UNAUTHORIZED environment variable to '0' makes TLS connections and HTTPS requests insecure by disabling certificate verification.
n8n            | (Use `node --trace-warnings ...` to show where the warning was created)
n8n            | 2025-10-14T22:37:10.754Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:37:10.754Z [Rudder] debug: cancelling existing flushTimer...
n8n            | 2025-10-14T22:37:12.877Z | debug | Skipped browserId check on /rest/push {"file":"auth.service.js","function":"resolveJwt"}
n8n            | 2025-10-14T22:37:12.881Z | debug | Add editor-UI session {"pushRef":"j1hsor5v9h","file":"abstract.push.js","function":"add"}
n8n            | 2025-10-14T22:37:56.930Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}
n8n            | 2025-10-14T22:38:53.966Z | debug | Removed editor-UI session {"pushRef":"j1hsor5v9h","file":"abstract.push.js","function":"remove"}
n8n            | 2025-10-14T22:38:54.445Z [Rudder] debug: no existing flush timer, creating new one
n8n            | 2025-10-14T22:38:56.930Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}
n8n            | Error fetching feature flags Error [PostHogFetchNetworkError]: Network error while fetching PostHog
n8n            |     at new PostHogFetchNetworkError (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/posthog-core/src/index.ts:41:5)
n8n            |     at PostHog.<anonymous> (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/posthog-core/src/index.ts:546:17)
n8n            |     at step (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/node_modules/tslib/tslib.es6.js:102:23)
n8n            |     at Object.throw (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/node_modules/tslib/tslib.es6.js:83:53)
n8n            |     at rejected (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/node_modules/tslib/tslib.es6.js:74:65)
n8n            |     at processTicksAndRejections (node:internal/process/task_queues:105:5) {
n8n            |   error: TypeError: fetch failed
n8n            |       at node:internal/deps/undici/undici:13510:13
n8n            |       at processTicksAndRejections (node:internal/process/task_queues:105:5) {
n8n            |     [cause]: Error: connect ECONNREFUSED 172.67.68.102:443
n8n            |         at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
n8n            |       errno: -111,
n8n            |       code: 'ECONNREFUSED',
n8n            |       syscall: 'connect',
n8n            |       address: '172.67.68.102',
n8n            |       port: 443
n8n            |     }
n8n            |   },
n8n            |   [cause]: TypeError: fetch failed
n8n            |       at node:internal/deps/undici/undici:13510:13
n8n            |       at processTicksAndRejections (node:internal/process/task_queues:105:5) {
n8n            |     [cause]: Error: connect ECONNREFUSED 172.67.68.102:443
n8n            |         at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
n8n            |       errno: -111,
n8n            |       code: 'ECONNREFUSED',
n8n            |       syscall: 'connect',
n8n            |       address: '172.67.68.102',
n8n            |       port: 443
n8n            |     }
n8n            |   }
n8n            | }
n8n            | 2025-10-14T22:39:04.445Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:39:04.445Z [Rudder] debug: cancelling existing flushTimer...
n8n            | 2025-10-14T22:39:06.637Z | debug | Skipped browserId check on /rest/push {"file":"auth.service.js","function":"resolveJwt"}
n8n            | 2025-10-14T22:39:06.638Z | debug | Add editor-UI session {"pushRef":"7rsiuxmjoz","file":"abstract.push.js","function":"add"}
n8n            | 2025-10-14T22:39:17.261Z | debug | Execution added {"executionId":"5","file":"active-executions.js","function":"add"}
n8n            | 2025-10-14T22:39:17.270Z | info | Enqueued execution 5 (job 5) {"scopes":["scaling"],"executionId":"5","jobId":"5","file":"scaling.service.js","function":"addJob"}
n8n            | 2025-10-14T22:39:18.146Z | debug | Received pubsub msg: relay-execution-lifecycle-event (executionStarted) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"executionStarted","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:39:18.147Z | debug | Pushed to frontend: executionStarted {"dataType":"executionStarted","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:39:18.149Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteBefore) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteBefore","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:39:18.149Z | debug | Pushed to frontend: nodeExecuteBefore {"dataType":"nodeExecuteBefore","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:39:18.368Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteBefore) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteBefore","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:39:18.368Z | debug | Pushed to frontend: nodeExecuteBefore {"dataType":"nodeExecuteBefore","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:39:18.369Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteAfter) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteAfter","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:39:18.370Z | debug | Pushed to frontend: nodeExecuteAfter {"dataType":"nodeExecuteAfter","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:39:18.370Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteAfterData) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteAfterData","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:39:18.370Z | debug | Pushed to frontend: nodeExecuteAfterData {"dataType":"nodeExecuteAfterData","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:39:19.618Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteBefore) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteBefore","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:39:19.619Z | debug | Pushed to frontend: nodeExecuteBefore {"dataType":"nodeExecuteBefore","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:39:56.930Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}
n8n            | 2025-10-14T22:40:56.930Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}
n8n            | 2025-10-14T22:41:05.817Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteAfter) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteAfter","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:41:05.818Z | debug | Pushed to frontend: nodeExecuteAfter {"dataType":"nodeExecuteAfter","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:41:05.819Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteAfterData) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteAfterData","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:41:05.819Z | debug | Pushed to frontend: nodeExecuteAfterData {"dataType":"nodeExecuteAfterData","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:41:05.825Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteAfter) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteAfter","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:41:05.826Z | debug | Pushed to frontend: nodeExecuteAfter {"dataType":"nodeExecuteAfter","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:41:05.827Z | debug | Received pubsub msg: relay-execution-lifecycle-event (nodeExecuteAfterData) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"nodeExecuteAfterData","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:41:05.827Z | debug | Pushed to frontend: nodeExecuteAfterData {"dataType":"nodeExecuteAfterData","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:41:05.874Z | debug | Received pubsub msg: relay-execution-lifecycle-event (executionFinished) {"scopes":["scaling","pubsub"],"msg":"relay-execution-lifecycle-event","channel":"n8n.commands","type":"executionFinished","executionId":"5","file":"subscriber.service.js","function":"parseMessage"}
n8n            | 2025-10-14T22:41:05.875Z | debug | Pushed to frontend: executionFinished {"dataType":"executionFinished","pushRefs":"7rsiuxmjoz","file":"abstract.push.js","function":"sendTo"}
n8n            | 2025-10-14T22:41:05.876Z | info | Execution 5 (job 5) finished successfully {"scopes":["scaling"],"workerId":"worker-0c2529f95ad3","executionId":"5","jobId":"5","file":"scaling.service.js"}
n8n            | 2025-10-14T22:41:05.912Z | debug | Execution finalized {"executionId":"5","file":"active-executions.js","function":"finalizeExecution"}
n8n            | 2025-10-14T22:41:05.920Z | debug | Execution removed {"executionId":"5","file":"active-executions.js"}
n8n            | 2025-10-14T22:41:05.936Z [Rudder] debug: no existing flush timer, creating new one



n8n            | 2025-10-14T22:41:15.937Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:41:15.937Z [Rudder] debug: cancelling existing flushTimer...
n8n            | 2025-10-14T22:41:56.931Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}
n8n            | 2025-10-14T22:42:24.838Z | debug | Removed editor-UI session {"pushRef":"7rsiuxmjoz","file":"abstract.push.js","function":"remove"}
n8n            | 2025-10-14T22:42:25.108Z [Rudder] debug: no existing flush timer, creating new one
n8n            | 2025-10-14T22:42:26.779Z | debug | Skipped browserId check on /rest/push {"file":"auth.service.js","function":"resolveJwt"}
n8n            | 2025-10-14T22:42:26.780Z | debug | Add editor-UI session {"pushRef":"z7ljuzqsai","file":"abstract.push.js","function":"add"}
n8n            | Error fetching feature flags Error [PostHogFetchNetworkError]: Network error while fetching PostHog
n8n            |     at new PostHogFetchNetworkError (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/posthog-core/src/index.ts:41:5)
n8n            |     at PostHog.<anonymous> (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/posthog-core/src/index.ts:546:17)
n8n            |     at step (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/node_modules/tslib/tslib.es6.js:102:23)
n8n            |     at Object.throw (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/node_modules/tslib/tslib.es6.js:83:53)
n8n            |     at rejected (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/posthog-node@3.2.1/node_modules/node_modules/tslib/tslib.es6.js:74:65)
n8n            |     at processTicksAndRejections (node:internal/process/task_queues:105:5) {
n8n            |   error: TypeError: fetch failed
n8n            |       at node:internal/deps/undici/undici:13510:13
n8n            |       at processTicksAndRejections (node:internal/process/task_queues:105:5) {
n8n            |     [cause]: Error: connect ECONNREFUSED 172.67.68.102:443
n8n            |         at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
n8n            |       errno: -111,
n8n            |       code: 'ECONNREFUSED',
n8n            |       syscall: 'connect',
n8n            |       address: '172.67.68.102',
n8n            |       port: 443
n8n            |     }
n8n            |   },
n8n            |   [cause]: TypeError: fetch failed
n8n            |       at node:internal/deps/undici/undici:13510:13
n8n            |       at processTicksAndRejections (node:internal/process/task_queues:105:5) {
n8n            |     [cause]: Error: connect ECONNREFUSED 172.67.68.102:443
n8n            |         at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16) {
n8n            |       errno: -111,
n8n            |       code: 'ECONNREFUSED',
n8n            |       syscall: 'connect',
n8n            |       address: '172.67.68.102',
n8n            |       port: 443
n8n            |     }
n8n            |   }
n8n            | }
n8n            | 2025-10-14T22:42:35.109Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:42:35.109Z [Rudder] debug: cancelling existing flushTimer...



-----------------------
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose logs -f n8n
Attaching to n8n
n8n            | 2025-10-14T22:36:45.900Z | debug | User settings loaded from: /home/node/.n8n/config {"file":"instance-settings.js","function":"loadOrCreate"}
n8n            | 2025-10-14T22:36:45.990Z | debug | Received CLI command {"execPath":"/usr/local/bin/node","scriptPath":"/usr/local/bin/n8n","args":[],"flags":{},"file":"cli-parser.js","function":"parse"}
n8n            | 2025-10-14T22:36:45.995Z | error | Last session crashed {"file":"crash-journal.js","function":"init"}
n8n            | 2025-10-14T22:36:55.999Z | info | Initializing n8n process {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.001Z | debug | Starting main instance in scaling mode {"scopes":["scaling"],"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.001Z | debug | Host ID: main-17acdc739da8 {"scopes":["scaling"],"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.295Z | debug | Lazy-loading nodes and credentials from n8n-nodes-base {"nodes":483,"credentials":385,"file":"lazy-package-directory-loader.js","function":"loadAll"}
n8n            | 2025-10-14T22:36:56.313Z | debug | Lazy-loading nodes and credentials from @n8n/n8n-nodes-langchain {"nodes":102,"credentials":23,"file":"lazy-package-directory-loader.js","function":"loadAll"}
n8n            | 2025-10-14T22:36:56.671Z | info | n8n ready on ::, port 5678 {"file":"abstract-server.js","function":"init"}
n8n            | 2025-10-14T22:36:56.690Z | debug | Initializing AuthRolesService... {"file":"auth.roles.service.js","function":"init"}
n8n            | 2025-10-14T22:36:56.701Z | debug | No scopes to update. {"file":"auth.roles.service.js","function":"syncScopes"}
n8n            | 2025-10-14T22:36:56.721Z | debug | No global roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.721Z | debug | No project roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.721Z | debug | No credential roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.722Z | debug | No workflow roles to update. {"file":"auth.roles.service.js","function":"syncRoles"}
n8n            | 2025-10-14T22:36:56.722Z | debug | AuthRolesService initialized successfully. {"file":"auth.roles.service.js","function":"init"}
n8n            | 2025-10-14T22:36:56.722Z | warn | Scaling mode is not officially supported with sqlite. Please use PostgreSQL instead. {"file":"base-command.js","function":"init"}
n8n            | 2025-10-14T22:36:56.734Z | debug | Started Redis client publisher(n8n) {"scopes":["redis","scaling"],"type":"publisher(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:56.767Z | info | n8n Task Broker ready on 127.0.0.1, port 5679 {"file":"task-broker-server.js","function":"setupHttpServer"}
n8n            | 2025-10-14T22:36:56.817Z | debug | Started Redis client cache(n8n) {"scopes":["redis","scaling"],"type":"cache(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:56.885Z | warn |
n8n            | There are deprecations related to your environment variables. Please take the recommended actions to update your configuration:
n8n            |  - DB_SQLITE_POOL_SIZE -> Running SQLite without a pool of read connections is deprecated. Please set `DB_SQLITE_POOL_SIZE` to a value higher than zero. See: https://docs.n8n.io/hosting/configuration/environment-variables/database/#sqlite
n8n            |  - N8N_BLOCK_ENV_ACCESS_IN_NODE -> The default value of N8N_BLOCK_ENV_ACCESS_IN_NODE will be changed from false to true in a future version. If you need to access environment variables from the Code Node or from expressions, please set N8N_BLOCK_ENV_ACCESS_IN_NODE=false. Learn more: https://docs.n8n.io/hosting/configuration/environment-variables/security/
n8n            |  - N8N_GIT_NODE_DISABLE_BARE_REPOS -> Support for bare repositories in the Git Node will be removed in a future version due to security concerns. If you are not using bare repositories in the Git Node, please set N8N_GIT_NODE_DISABLE_BARE_REPOS=true. Learn more: https://docs.n8n.io/hosting/configuration/environment-variables/security/
n8n            |  {"file":"deprecation.service.js","function":"warn"}
n8n            | 2025-10-14T22:36:56.893Z | debug | Registered a "reload-license" event handler on License#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.894Z | debug | Registered a "relay-execution-lifecycle-event" event handler on Push#handleRelayExecutionLifecycleEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.894Z | debug | Registered a "reload-overwrite-credentials" event handler on CredentialsOverwrites#reloadOverwriteCredentials {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.894Z | debug | Registered a "clear-test-webhooks" event handler on TestWebhooks#handleClearTestWebhooks {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "display-workflow-activation" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "display-workflow-deactivation" event handler on ActiveWorkflowManager#handleDisplayWorkflowDeactivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "display-workflow-activation-error" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivationError {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.895Z | debug | Registered a "add-webhooks-triggers-and-pollers" event handler on ActiveWorkflowManager#handleAddWebhooksTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.896Z | debug | Registered a "remove-triggers-and-pollers" event handler on ActiveWorkflowManager#handleRemoveTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.896Z | debug | Registered a "restart-event-bus" event handler on MessageEventBus#restart {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.897Z | debug | Registered a "response-to-get-worker-status" event handler on WorkerStatusService#handleWorkerStatusResponse {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.897Z | debug | Registered a "community-package-update" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.898Z | debug | Registered a "community-package-install" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.898Z | debug | Registered a "community-package-uninstall" event handler on CommunityPackagesService#handleUninstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:36:56.899Z | debug | Started Redis client subscriber(n8n) {"scopes":["redis","scaling"],"type":"subscriber(n8n)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:56.920Z | debug | Subscribed to channel n8n.commands {"scopes":["scaling","pubsub"],"file":"subscriber.service.js"}
n8n            | 2025-10-14T22:36:56.922Z | debug | Subscribed to channel n8n.worker-response {"scopes":["scaling","pubsub"],"file":"subscriber.service.js"}
n8n            | 2025-10-14T22:36:56.924Z | debug | [license SDK] initializing for deviceFingerprint e534fde58f3e53a0d28cbf6e83277281b82ee134a6f6e38802134cf2c2a5c9a9 {"scopes":["license"],"file":"LicenseManager.js","function":"log"}
n8n            | 2025-10-14T22:36:56.928Z | info | [license SDK] Skipping renewal on init: license cert is not initialized {"scopes":["license"],"file":"LicenseManager.js","function":"log"}
n8n            | 2025-10-14T22:36:56.929Z | debug | License initialized {"scopes":["license"],"file":"license.js","function":"init"}
n8n            | 2025-10-14T22:36:56.929Z | debug | Querying database for waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"getWaitingExecutions"}
n8n            | 2025-10-14T22:36:56.933Z | debug | Started tracking waiting executions {"scopes":["waiting-executions"],"file":"wait-tracker.js","function":"startTracking"}
n8n            | 2025-10-14T22:36:56.933Z | debug | Wait tracker init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.933Z | debug | Loading overwrite credentials from static envvar {"file":"credentials-overwrites.js","function":"init"}
n8n            | 2025-10-14T22:36:56.934Z | debug | Credentials overwrites init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.939Z | debug | Binary data service init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.940Z | debug | Data deduplication service init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.940Z | debug | External hooks init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.941Z | debug | Workflow history init complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:56.951Z | debug | Test runner cleanup complete {"file":"start.js","function":"init"}
n8n            | 2025-10-14T22:36:58.519Z | debug | Started flushing timer {"scopes":["insights"],"file":"insights-collection.service.js","function":"startFlushingTimer"}
n8n            | 2025-10-14T22:36:58.519Z | debug | Started compaction timer {"scopes":["insights"],"file":"insights-compaction.service.js","function":"startCompactionTimer"}
n8n            | 2025-10-14T22:36:58.520Z | debug | Started pruning timer {"scopes":["insights"],"file":"insights-pruning.service.js","function":"startPruningTimer"}
n8n            | 2025-10-14T22:36:58.520Z | debug | Initialized module "insights" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.521Z | debug | Skipped init for unlicensed module "external-secrets" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.525Z | debug | Initialized module "community-packages" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.548Z | debug | Initialized module "data-table" {"file":"module-registry.js","function":"initModules"}
n8n            | 2025-10-14T22:36:58.556Z | debug | Starting legacy SQLite execution recovery... {"scopes":["legacy-sqlite-execution-recovery"],"file":"legacy-sqlite-execution-recovery.service.js","function":"cleanupWorkflowExecutions"}
n8n            | 2025-10-14T22:36:58.558Z | debug | Legacy SQLite execution recovery completed. {"scopes":["legacy-sqlite-execution-recovery"],"file":"legacy-sqlite-execution-recovery.service.js","function":"cleanupWorkflowExecutions"}
n8n            | 2025-10-14T22:36:59.400Z | debug | Started Redis client client(bull) {"scopes":["redis","scaling"],"type":"client(bull)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:59.405Z | debug | Started Redis client subscriber(bull) {"scopes":["redis","scaling"],"type":"subscriber(bull)","host":"redis","port":6379,"file":"redis-client.service.js","function":"createRegularClient"}
n8n            | 2025-10-14T22:36:59.406Z | debug | Queue setup completed {"scopes":["scaling"],"file":"scaling.service.js","function":"setupQueue"}
n8n            | 2025-10-14T22:36:59.722Z | debug | Completed queue recovery check, no dangling executions {"scopes":["scaling"],"file":"scaling.service.js","function":"recoverFromQueue"}
n8n            | 2025-10-14T22:36:59.723Z | debug | Scheduled queue recovery check for next 180 min {"scopes":["scaling"],"file":"scaling.service.js","function":"scheduleQueueRecovery"}
n8n            | 2025-10-14T22:37:00.533Z | debug | OIDC login is disabled. {"file":"oidc.service.ee.js","function":"init"}
n8n            | 2025-10-14T22:37:00.540Z | info | Registered runner "JS Task Runner" (KolhcMbttmhfUEAToqjLX)  {"file":"task-broker-ws-server.js","function":"onMessage"}
n8n            | 2025-10-14T22:37:00.589Z | debug | Registered a "reload-license" event handler on License#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.589Z | debug | Registered a "relay-execution-lifecycle-event" event handler on Push#handleRelayExecutionLifecycleEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "reload-overwrite-credentials" event handler on CredentialsOverwrites#reloadOverwriteCredentials {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "clear-test-webhooks" event handler on TestWebhooks#handleClearTestWebhooks {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "display-workflow-activation" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "display-workflow-deactivation" event handler on ActiveWorkflowManager#handleDisplayWorkflowDeactivation {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.590Z | debug | Registered a "display-workflow-activation-error" event handler on ActiveWorkflowManager#handleDisplayWorkflowActivationError {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "add-webhooks-triggers-and-pollers" event handler on ActiveWorkflowManager#handleAddWebhooksTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "remove-triggers-and-pollers" event handler on ActiveWorkflowManager#handleRemoveTriggersAndPollers {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "restart-event-bus" event handler on MessageEventBus#restart {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "response-to-get-worker-status" event handler on WorkerStatusService#handleWorkerStatusResponse {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.591Z | debug | Registered a "community-package-update" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "community-package-install" event handler on CommunityPackagesService#handleInstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "community-package-uninstall" event handler on CommunityPackagesService#handleUninstallEvent {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "reload-saml-config" event handler on SamlService#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.592Z | debug | Registered a "reload-oidc-config" event handler on OidcService#reload {"scopes":["pubsub"],"file":"pubsub.registry.js","function":"init"}
n8n            | 2025-10-14T22:37:00.661Z | debug | Initializing event bus... {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.663Z | debug | Initializing event writer {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.667Z | debug | Checking for unsent event messages {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.729Z | debug | Start logging into /home/node/.n8n/n8nEventLog.log  {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.730Z | debug | MessageEventBus initialized {"file":"message-event-bus.js","function":"initialize"}
n8n            | 2025-10-14T22:37:00.733Z | info | Version: 1.115.3 {"file":"abstract-server.js","function":"start"}
n8n            | 2025-10-14T22:37:00.733Z | debug | Server ID: main-17acdc739da8 {"file":"server.js","function":"start"}
n8n            | 2025-10-14T22:37:00.738Z | debug | Soft-deletion every 60 minutes {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"scheduleRollingSoftDeletions"}
n8n            | 2025-10-14T22:37:00.739Z | debug | Hard-deletion in next 15 minutes {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"scheduleNextHardDeletion"}
n8n            | 2025-10-14T22:37:00.739Z | debug | Started pruning timers {"scopes":["pruning"],"file":"executions-pruning.service.js","function":"startPruning"}
n8n            | 2025-10-14T22:37:00.744Z | error | Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload {"file":"error-reporter.js","function":"defaultReport"}
n8n            | 2025-10-14T22:37:00.749Z [Rudder] debug: in flush
n8n            | 2025-10-14T22:37:00.753Z [Rudder] debug: no existing flush timer, creating new one
n8n            | 2025-10-14T22:37:00.772Z | info |
n8n            | Editor is now accessible via:
n8n            | http://localhost:5678 {"file":"base-command.js","function":"log"}
n8n            | (node:1) Warning: Setting the NODE_TLS_REJECT_UNAUTHORIZED environment variable to '0' makes TLS connections and HTTPS requests insecure by disabling certificate verification.
n8n            | (Use `node --trace-warnings ...` to show where the warning was created)












+++++++++++++++++++++++++++


FROM n8nio/n8n:latest

ARG HTTP_PROXY=http://10.132.222.73:9090
ARG HTTPS_PROXY=http://10.132.222.73:9090
ARG NO_PROXY=localhost,127.0.0.1

USER root

# Configurar npm para usar el proxy
RUN npm config set proxy ${HTTP_PROXY} && \
    npm config set https-proxy ${HTTPS_PROXY} && \
    npm config set strict-ssl false

# Crear directorio para global-agent
RUN mkdir -p /opt/global-agent

# Instalar global-agent en una ubicación separada
RUN cd /opt/global-agent && \
    npm install global-agent && \
    chown -R node:node /opt/global-agent

# Limpiar configuración de proxy
RUN npm config delete proxy && \
    npm config delete https-proxy

# Crear script de inicio
RUN echo '#!/bin/sh' > /usr/local/bin/start-n8n.sh && \
    echo 'export NODE_PATH=/opt/global-agent/node_modules:$NODE_PATH' >> /usr/local/bin/start-n8n.sh && \
    echo 'exec node -r global-agent/bootstrap /usr/local/bin/n8n "$@"' >> /usr/local/bin/start-n8n.sh && \
    chmod +x /usr/local/bin/start-n8n.sh

USER node

ENTRYPOINT ["/usr/local/bin/start-n8n.sh"]


\\\\\\\\\\\\\\

root@sapl8464:/home/dockeruser/n8n-worker# docker-compose build --no-cache
postgres uses an image, skipping
pgadmin uses an image, skipping
redis uses an image, skipping
redis_admin uses an image, skipping
Building n8n
[+] Building 28.2s (7/9)                                                                                                                                                                       docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                     0.0s
 => => transferring dockerfile: 1.15kB                                                                                                                                                                   0.0s
 => [internal] load metadata for docker.io/n8nio/n8n:latest                                                                                                                                              1.4s
 => [auth] n8nio/n8n:pull token for registry-1.docker.io                                                                                                                                                 0.0s
 => [internal] load .dockerignore                                                                                                                                                                        0.0s
 => => transferring context: 2B                                                                                                                                                                          0.0s
 => CACHED [1/5] FROM docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                 0.0s
 => => resolve docker.io/n8nio/n8n:latest@sha256:fa410b71ccb5ddee9f9e4b25a964fbc8fcf56744d5f24dc4d2b8b414ae76ee26                                                                                        0.0s
 => [2/5] RUN npm config set proxy http://10.132.222.73:9090 &&     npm config set https-proxy http://10.132.222.73:9090 &&     npm config set strict-ssl false                                          1.1s
 => ERROR [3/5] RUN cd /usr/local/lib/node_modules/n8n &&     npm install global-agent                                                                                                                  25.4s
------
 > [3/5] RUN cd /usr/local/lib/node_modules/n8n &&     npm install global-agent:
25.09 npm error code EUNSUPPORTEDPROTOCOL
25.09 npm error Unsupported URL Type "workspace:": workspace:*
25.10 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-10-14T22_29_56_066Z-debug-0.log
------
Dockerfile:16
--------------------
  15 |     # Instalar global-agent en el directorio de n8n (accesible para usuario node)
  16 | >>> RUN cd /usr/local/lib/node_modules/n8n && \
  17 | >>>     npm install global-agent
  18 |
--------------------
ERROR: failed to build: failed to solve: process "/bin/sh -c cd /usr/local/lib/node_modules/n8n &&     npm install global-agent" did not complete successfully: exit code: 1
ERROR: Service 'n8n' failed to build : Build failed
root@sapl8464:/home/dockeruser/n8n-worker#




///////////////


# Detener y eliminar contenedores
docker-compose down

# Ver qué imágenes tienes
docker images | grep n8n

# Eliminar las imágenes viejas de n8n (opcional pero recomendado)
docker-compose down --rmi all

# O manualmente eliminar imágenes huérfanas
docker image prune -a

# Ahora reconstruir desde cero
docker-compose build --no-cache

# Levantar de nuevo
docker-compose up -d




+++++++++++++++++++++++++++

FROM n8nio/n8n:latest

# Configurar proxy para npm durante la construcción
ARG HTTP_PROXY=http://10.132.222.73:9090
ARG HTTPS_PROXY=http://10.132.222.73:9090
ARG NO_PROXY=localhost,127.0.0.1

USER root

# Configurar npm para usar el proxy
RUN npm config set proxy ${HTTP_PROXY} && \
    npm config set https-proxy ${HTTPS_PROXY} && \
    npm config set strict-ssl false

# Instalar global-agent en el directorio de n8n (accesible para usuario node)
RUN cd /usr/local/lib/node_modules/n8n && \
    npm install global-agent

# Limpiar configuración de proxy de npm
RUN npm config delete proxy && \
    npm config delete https-proxy

# Crear script de inicio que busque global-agent en node_modules de n8n
RUN echo '#!/bin/sh' > /usr/local/bin/start-n8n.sh && \
    echo 'export NODE_PATH=/usr/local/lib/node_modules/n8n/node_modules:$NODE_PATH' >> /usr/local/bin/start-n8n.sh && \
    echo 'exec node -r global-agent/bootstrap /usr/local/bin/n8n "$@"' >> /usr/local/bin/start-n8n.sh && \
    chmod +x /usr/local/bin/start-n8n.sh

USER node

ENTRYPOINT ["/usr/local/bin/start-n8n.sh"]



//////////////+++++++++++++++++++++++++++++++
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose logs -f n8n
Attaching to n8n
n8n            | node:internal/modules/cjs/loader:1386
n8n            |   throw err;
n8n            |   ^
n8n            |
n8n            | Error: Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload
n8n            |     at Function._resolveFilename (node:internal/modules/cjs/loader:1383:15)
n8n            |     at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
n8n            |     at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
n8n            |     at Function._load (node:internal/modules/cjs/loader:1192:37)
n8n            |     at TracingChannel.traceSync (node:diagnostics_channel:322:14)
n8n            |     at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
n8n            |     at Module.require (node:internal/modules/cjs/loader:1463:12)
n8n            |     at node:internal/modules/cjs/loader:1989:12
n8n            |     at loadPreloadModules (node:internal/process/pre_execution:733:5)
n8n            |     at setupUserModules (node:internal/process/pre_execution:208:5) {
n8n            |   code: 'MODULE_NOT_FOUND',
n8n            |   requireStack: [ 'internal/preload' ]
n8n            | }
n8n            |
n8n            | Node.js v22.20.0
n8n            | node:internal/modules/cjs/loader:1386
n8n            |   throw err;
n8n            |   ^
n8n            |
n8n            | Error: Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload
n8n            |     at Function._resolveFilename (node:internal/modules/cjs/loader:1383:15)
n8n            |     at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
n8n            |     at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
n8n            |     at Function._load (node:internal/modules/cjs/loader:1192:37)
n8n            |     at TracingChannel.traceSync (node:diagnostics_channel:322:14)
n8n            |     at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
n8n            |     at Module.require (node:internal/modules/cjs/loader:1463:12)
n8n            |     at node:internal/modules/cjs/loader:1989:12
n8n            |     at loadPreloadModules (node:internal/process/pre_execution:733:5)
n8n            |     at setupUserModules (node:internal/process/pre_execution:208:5) {
n8n            |   code: 'MODULE_NOT_FOUND',
n8n            |   requireStack: [ 'internal/preload' ]
n8n            | }
n8n            |
n8n            | Node.js v22.20.0
n8n            | node:internal/modules/cjs/loader:1386
n8n            |   throw err;
n8n            |   ^
n8n            |
n8n            | Error: Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload
n8n            |     at Function._resolveFilename (node:internal/modules/cjs/loader:1383:15)
n8n            |     at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
n8n            |     at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
n8n            |     at Function._load (node:internal/modules/cjs/loader:1192:37)
n8n            |     at TracingChannel.traceSync (node:diagnostics_channel:322:14)
n8n            |     at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
n8n            |     at Module.require (node:internal/modules/cjs/loader:1463:12)
n8n            |     at node:internal/modules/cjs/loader:1989:12
n8n            |     at loadPreloadModules (node:internal/process/pre_execution:733:5)
n8n            |     at setupUserModules (node:internal/process/pre_execution:208:5) {
n8n            |   code: 'MODULE_NOT_FOUND',
n8n            |   requireStack: [ 'internal/preload' ]
n8n            | }
n8n            |
n8n            | Node.js v22.20.0
n8n            | node:internal/modules/cjs/loader:1386
n8n            |   throw err;
n8n            |   ^
n8n            |
n8n            | Error: Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload
n8n            |     at Function._resolveFilename (node:internal/modules/cjs/loader:1383:15)
n8n            |     at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
n8n            |     at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
n8n            |     at Function._load (node:internal/modules/cjs/loader:1192:37)
n8n            |     at TracingChannel.traceSync (node:diagnostics_channel:322:14)
n8n            |     at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
n8n            |     at Module.require (node:internal/modules/cjs/loader:1463:12)
n8n            |     at node:internal/modules/cjs/loader:1989:12
n8n            |     at loadPreloadModules (node:internal/process/pre_execution:733:5)
n8n            |     at setupUserModules (node:internal/process/pre_execution:208:5) {
n8n            |   code: 'MODULE_NOT_FOUND',
n8n            |   requireStack: [ 'internal/preload' ]
n8n            | }
n8n            |
n8n            | Node.js v22.20.0
n8n            | node:internal/modules/cjs/loader:1386
n8n            |   throw err;
n8n            |   ^
n8n            |
n8n            | Error: Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload
n8n            |     at Function._resolveFilename (node:internal/modules/cjs/loader:1383:15)
n8n            |     at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
n8n            |     at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
n8n            |     at Function._load (node:internal/modules/cjs/loader:1192:37)
n8n            |     at TracingChannel.traceSync (node:diagnostics_channel:322:14)
n8n            |     at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
n8n            |     at Module.require (node:internal/modules/cjs/loader:1463:12)
n8n            |     at node:internal/modules/cjs/loader:1989:12
n8n            |     at loadPreloadModules (node:internal/process/pre_execution:733:5)
n8n            |     at setupUserModules (node:internal/process/pre_execution:208:5) {
n8n            |   code: 'MODULE_NOT_FOUND',
n8n            |   requireStack: [ 'internal/preload' ]
n8n            | }
n8n            |
n8n            | Node.js v22.20.0
n8n            | node:internal/modules/cjs/loader:1386
n8n            |   throw err;
n8n            |   ^
n8n            |
n8n            | Error: Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload
n8n            |     at Function._resolveFilename (node:internal/modules/cjs/loader:1383:15)
n8n            |     at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
n8n            |     at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
n8n            |     at Function._load (node:internal/modules/cjs/loader:1192:37)
n8n            |     at TracingChannel.traceSync (node:diagnostics_channel:322:14)
n8n            |     at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
n8n            |     at Module.require (node:internal/modules/cjs/loader:1463:12)
n8n            |     at node:internal/modules/cjs/loader:1989:12
n8n            |     at loadPreloadModules (node:internal/process/pre_execution:733:5)
n8n            |     at setupUserModules (node:internal/process/pre_execution:208:5) {
n8n            |   code: 'MODULE_NOT_FOUND',
n8n            |   requireStack: [ 'internal/preload' ]
n8n            | }
n8n            |
n8n            | Node.js v22.20.0
n8n            | node:internal/modules/cjs/loader:1386
n8n            |   throw err;
n8n            |   ^
n8n            |
n8n            | Error: Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload
n8n            |     at Function._resolveFilename (node:internal/modules/cjs/loader:1383:15)
n8n            |     at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
n8n            |     at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
n8n            |     at Function._load (node:internal/modules/cjs/loader:1192:37)
n8n            |     at TracingChannel.traceSync (node:diagnostics_channel:322:14)
n8n            |     at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
n8n            |     at Module.require (node:internal/modules/cjs/loader:1463:12)
n8n            |     at node:internal/modules/cjs/loader:1989:12
n8n            |     at loadPreloadModules (node:internal/process/pre_execution:733:5)
n8n            |     at setupUserModules (node:internal/process/pre_execution:208:5) {
n8n            |   code: 'MODULE_NOT_FOUND',
n8n            |   requireStack: [ 'internal/preload' ]
n8n            | }
n8n            |
n8n            | Node.js v22.20.0
n8n            | node:internal/modules/cjs/loader:1386
n8n            |   throw err;
n8n            |   ^
n8n            |
n8n            | Error: Cannot find module 'global-agent/bootstrap'
n8n            | Require stack:
n8n            | - internal/preload
n8n            |     at Function._resolveFilename (node:internal/modules/cjs/loader:1383:15)
n8n            |     at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
n8n            |     at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
n8n            |     at Function._load (node:internal/modules/cjs/loader:1192:37)
n8n            |     at TracingChannel.traceSync (node:diagnostics_channel:322:14)
n8n            |     at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
n8n            |     at Module.require (node:internal/modules/cjs/loader:1463:12)
n8n            |     at node:internal/modules/cjs/loader:1989:12
n8n            |     at loadPreloadModules (node:internal/process/pre_execution:733:5)
n8n            |     at setupUserModules (node:internal/process/pre_execution:208:5) {
n8n            |   code: 'MODULE_NOT_FOUND',
n8n            |   requireStack: [ 'internal/preload' ]
n8n            | }
n8n            |
n8n            | Node.js v22.20.0
n8n exited with code 1
root@sapl8464:/home/dockeruser/n8n-worker#




------------------------------
FROM n8nio/n8n:latest

# Configurar proxy para npm durante la construcción
ARG HTTP_PROXY=http://10.132.222.73:9090
ARG HTTPS_PROXY=http://10.132.222.73:9090
ARG NO_PROXY=localhost,127.0.0.1

USER root

# Configurar npm para usar el proxy
RUN npm config set proxy ${HTTP_PROXY} && \
    npm config set https-proxy ${HTTPS_PROXY} && \
    npm config set strict-ssl false

# Instalar global-agent
RUN npm install -g global-agent

# Limpiar configuración de proxy de npm (por seguridad)
RUN npm config delete proxy && \
    npm config delete https-proxy

# Crear script de inicio personalizado
RUN echo '#!/bin/sh' > /usr/local/bin/start-n8n.sh && \
    echo 'exec node -r global-agent/bootstrap /usr/local/bin/n8n "$@"' >> /usr/local/bin/start-n8n.sh && \
    chmod +x /usr/local/bin/start-n8n.sh

USER node

ENTRYPOINT ["/usr/local/bin/start-n8n.sh"]

------------------


root@sapl8464:/home/dockeruser/n8n-worker# docker-compose build --no-cache
postgres uses an image, skipping
pgadmin uses an image, skipping
redis uses an image, skipping
redis_admin uses an image, skipping
Building n8n
[+] Building 73.2s (5/6)                                                                                                                                                                       docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                     0.0s
 => => transferring dockerfile: 856B                                                                                                                                                                     0.0s
 => [internal] load metadata for docker.io/n8nio/n8n:latest                                                                                                                                              0.0s
 => [internal] load .dockerignore                                                                                                                                                                        0.0s
 => => transferring context: 2B                                                                                                                                                                          0.0s
 => [1/3] FROM docker.io/n8nio/n8n:latest                                                                                                                                                                0.5s
 => ERROR [2/3] RUN npm install -g global-agent                                                                                                                                                         72.5s
------
 > [2/3] RUN npm install -g global-agent:
72.35 npm error code ECONNREFUSED
72.35 npm error errno ECONNREFUSED
72.36 npm error FetchError: request to https://registry.npmjs.org/global-agent failed, reason:
72.36 npm error     at ClientRequest.<anonymous> (/usr/local/lib/node_modules/npm/node_modules/minipass-fetch/lib/index.js:130:14)
72.36 npm error     at ClientRequest.emit (node:events:519:28)
72.36 npm error     at emitErrorEvent (node:_http_client:105:11)
72.36 npm error     at _destroy (node:_http_client:898:9)
72.36 npm error     at onSocketNT (node:_http_client:918:5)
72.36 npm error     at process.processTicksAndRejections (node:internal/process/task_queues:91:21) {
72.36 npm error   code: 'ECONNREFUSED',
72.36 npm error   errno: 'ECONNREFUSED',
72.36 npm error   type: 'system',
72.36 npm error   requiredBy: '.'
72.36 npm error }
72.36 npm error
72.36 npm error If you are behind a proxy, please make sure that the
72.36 npm error 'proxy' config is set properly.  See: 'npm help config'
72.36 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-10-14T22_14_14_435Z-debug-0.log
------
Dockerfile:9
--------------------
   7 |     # Instalamos global-agent: es una librería de Node.js que intercepta
   8 |     # TODAS las peticiones HTTP/HTTPS y las redirige al proxy
   9 | >>> RUN npm install -g global-agent
  10 |
  11 |     # Creamos un script personalizado que inicia n8n con global-agent activado
--------------------
ERROR: failed to build: failed to solve: process "/bin/sh -c npm install -g global-agent" did not complete successfully: exit code: 1
ERROR: Service 'n8n' failed to build : Build failed
root@sapl8464:/home/dockeruser/n8n-worker#






---------------------


docker-compose.yml  Dokerfile  pgadmin_data
root@sapl8464:/home/dockeruser/n8n-worker# docker-compose build --no-cache
postgres uses an image, skipping
pgadmin uses an image, skipping
redis uses an image, skipping
redis_admin uses an image, skipping
Building n8n
[+] Building 0.2s (1/1) FINISHED                                                                                                                                                               docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                     0.1s
 => => transferring dockerfile: 2B                                                                                                                                                                       0.0s
ERROR: failed to build: failed to solve: failed to read dockerfile: open Dockerfile: no such file or directory
ERROR: Service 'n8n' failed to build : Build failed
root@sapl8464:/home/dockeruser/n8n-worker#


***********************

services:
  n8n:
    build: .  # ← CAMBIO CLAVE: Construye desde el Dockerfile local
    container_name: n8n
    restart: always
    ports:
      - "5678:5678"
    environment:
      # ============================================================
      # CONFIGURACIÓN DE PROXY - EXPLICACIÓN DETALLADA
      # ============================================================
      
      # Variables para global-agent (librería de Node.js)
      # Estas SON NECESARIAS porque Node.js no lee HTTP_PROXY por defecto
      - GLOBAL_AGENT_HTTP_PROXY=http://10.132.222.73:9090
      - GLOBAL_AGENT_HTTPS_PROXY=http://10.132.222.73:9090
      - GLOBAL_AGENT_NO_PROXY=localhost,127.0.0.1,postgres,redis
      
      # Variables tradicionales de proxy (para herramientas del sistema)
      # Estas las usa curl, wget, apt, pero NO Node.js directamente
      - HTTP_PROXY=http://10.132.222.73:9090
      - HTTPS_PROXY=http://10.132.222.73:9090
      - NO_PROXY=localhost,127.0.0.1,postgres,redis
      
      # Deshabilitar validación de certificados SSL
      # IMPORTANTE: Úsalo solo si el proxy intercepta SSL
      - NODE_TLS_REJECT_UNAUTHORIZED=0
      # ============================================================

      # Configuración de n8n
      - N8N_SECURE_COOKIE=false
      - N8N_BASIC_AUTH_ACTIVE=${N8N_BASIC_AUTH_ACTIVE}
      - N8N_BASIC_AUTH_USER=${N8N_BASIC_AUTH_USER}
      - N8N_BASIC_AUTH_PASSWORD=${N8N_BASIC_AUTH_PASSWORD}
      - N8N_HOST=${N8N_HOST}
      - N8N_PORT=${N8N_PORT}
      - N8N_PROTOCOL=${N8N_PROTOCOL}
      - N8N_LOG_LEVEL=${N8N_LOG_LEVEL}
      - NODE_ENV=production
      - WEBHOOK_URL=${WEBHOOK_URL}
      - GENERIC_TIMEZONE=${GENERIC_TIMEZONE}

      # Configuración de la base de datos
      - N8N_POSTGRES_HOST=postgres
      - N8N_POSTGRES_PORT=5432
      - N8N_POSTGRES_USER=${POSTGRES_USER}
      - N8N_POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - N8N_POSTGRES_DB=${POSTGRES_DB}

      # Configuración de la encriptación
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY}
      - N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=false
      - N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=true

      # Cola y Redis
      - EXECUTIONS_MODE=queue
      - N8N_DISABLE_EXECUTIONS=true
      - QUEUE_BULL_REDIS_ENABLED=true
      - QUEUE_BULL_REDIS_HOST=redis
      - QUEUE_BULL_REDIS_PORT=6379
      - N8N_RUNNERS_ENABLED=true
      - OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS=true

    volumes:
      - n8n_data:/home/node/.n8n
    networks:
      - n8n_network
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy

  postgres:
    image: postgres:13
    container_name: n8n_postgres
    restart: always
    environment:
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=${POSTGRES_DB}
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 5s
      timeout: 5s
      retries: 10
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - n8n_network

  pgadmin:
    image: dpage/pgadmin4
    container_name: n8n_pgadmin
    restart: always
    environment:
      - PGADMIN_DEFAULT_EMAIL=${PGADMIN_DEFAULT_EMAIL}
      - PGADMIN_DEFAULT_PASSWORD=${PGADMIN_DEFAULT_PASSWORD}
    ports:
      - "8080:80"
    volumes:
      - ./pgadmin_data:/var/lib/pgadmin
    networks:
      - n8n_network
    depends_on:
      - postgres

  n8n_worker1:
    build: .  # ← CAMBIO: También usa el Dockerfile
    container_name: n8n_worker1
    restart: always
    environment:
      # ============================================================
      # CONFIGURACIÓN DE PROXY (igual que el contenedor principal)
      # ============================================================
      - GLOBAL_AGENT_HTTP_PROXY=http://10.132.222.73:9090
      - GLOBAL_AGENT_HTTPS_PROXY=http://10.132.222.73:9090
      - GLOBAL_AGENT_NO_PROXY=localhost,127.0.0.1,postgres,redis,n8n
      - HTTP_PROXY=http://10.132.222.73:9090
      - HTTPS_PROXY=http://10.132.222.73:9090
      - NO_PROXY=localhost,127.0.0.1,postgres,redis,n8n
      - NODE_TLS_REJECT_UNAUTHORIZED=0
      # ============================================================

      # Configuración de la base de datos
      - N8N_POSTGRES_HOST=postgres
      - N8N_POSTGRES_PORT=5432
      - N8N_POSTGRES_USER=${POSTGRES_USER}
      - N8N_POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - N8N_POSTGRES_DB=${POSTGRES_DB}
      - NODE_ENV=production
      - N8N_LOG_LEVEL=debug
      - GENERIC_TIMEZONE=${GENERIC_TIMEZONE}

      # Configuración de la cola y Redis
      - N8N_EXECUTIONS_PROCESS=worker
      - EXECUTIONS_MODE=queue
      - QUEUE_BULL_REDIS_ENABLED=true
      - QUEUE_BULL_REDIS_HOST=redis
      - QUEUE_BULL_REDIS_PORT=6379
      - N8N_WORKER_CONCURRENCY=10
      - N8N_RUNNERS_ENABLED=true
      - OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS=true

      # Configuración de la encriptación
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY}
      - N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=false
      - N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=true

    volumes:
      - n8n_data:/home/node/.n8n
    depends_on:
      n8n:
        condition: service_started
      redis:
        condition: service_healthy
    networks:
      - n8n_network
    command: worker

  n8n_worker2:
    build: .  # ← CAMBIO: También usa el Dockerfile
    container_name: n8n_worker2
    restart: always
    environment:
      # ============================================================
      # CONFIGURACIÓN DE PROXY (igual que los anteriores)
      # ============================================================
      - GLOBAL_AGENT_HTTP_PROXY=http://10.132.222.73:9090
      - GLOBAL_AGENT_HTTPS_PROXY=http://10.132.222.73:9090
      - GLOBAL_AGENT_NO_PROXY=localhost,127.0.0.1,postgres,redis,n8n
      - HTTP_PROXY=http://10.132.222.73:9090
      - HTTPS_PROXY=http://10.132.222.73:9090
      - NO_PROXY=localhost,127.0.0.1,postgres,redis,n8n
      - NODE_TLS_REJECT_UNAUTHORIZED=0
      # ============================================================

      # Configuración de la base de datos
      - N8N_POSTGRES_HOST=postgres
      - N8N_POSTGRES_PORT=5432
      - N8N_POSTGRES_USER=${POSTGRES_USER}
      - N8N_POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - N8N_POSTGRES_DB=${POSTGRES_DB}
      - NODE_ENV=production
      - N8N_LOG_LEVEL=debug
      - GENERIC_TIMEZONE=${GENERIC_TIMEZONE}

      # Configuración de la cola y Redis
      - N8N_EXECUTIONS_PROCESS=worker
      - EXECUTIONS_MODE=queue
      - QUEUE_BULL_REDIS_ENABLED=true
      - QUEUE_BULL_REDIS_HOST=redis
      - QUEUE_BULL_REDIS_PORT=6379
      - N8N_WORKER_CONCURRENCY=10
      - N8N_RUNNERS_ENABLED=true
      - OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS=true

      # Configuración de la encriptación
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY}
      - N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=false
      - N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=true

    volumes:
      - n8n_data:/home/node/.n8n
    depends_on:
      n8n:
        condition: service_started
      redis:
        condition: service_healthy
    networks:
      - n8n_network
    command: worker

  redis:
    image: redis:6-alpine
    container_name: n8n_redis
    restart: always
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 3s
      retries: 10
    networks:
      - n8n_network

  redis_admin:
    image: rediscommander/redis-commander:latest
    container_name: n8n_redis_admin
    restart: always
    environment:
      - REDIS_HOSTS=local:redis:6379
    ports:
      - "8081:8081"
    depends_on:
      redis:
        condition: service_healthy
    networks:
      - n8n_network

networks:
  n8n_network:
    driver: bridge

volumes:
  postgres_data:
  redis_data:
  n8n_data:
  pgadmin_data:

*****************************

# Usamos la imagen oficial de n8n
FROM n8nio/n8n:latest

# Cambiamos a usuario root para instalar paquetes
USER root

# Instalamos global-agent: es una librería de Node.js que intercepta 
# TODAS las peticiones HTTP/HTTPS y las redirige al proxy
RUN npm install -g global-agent

# Creamos un script personalizado que inicia n8n con global-agent activado
# El "-r global-agent/bootstrap" carga global-agent ANTES de que n8n inicie
RUN echo '#!/bin/sh' > /usr/local/bin/start-n8n.sh && \
    echo 'exec node -r global-agent/bootstrap /usr/local/bin/n8n "$@"' >> /usr/local/bin/start-n8n.sh && \
    chmod +x /usr/local/bin/start-n8n.sh

# Volvemos al usuario node (por seguridad)
USER node

# Definimos el punto de entrada con nuestro script personalizado
ENTRYPOINT ["/usr/local/bin/start-n8n.sh"]

  
